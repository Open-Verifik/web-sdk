<div class="flex flex-col flex-auto items-center sm:justify-center min-w-0" *ngIf="project">
    <div class="w-full sm:w-auto py-8 px-4 sm:p-12 sm:rounded-2xl sm:shadow sm:bg-card mx-auto main-card"
        *ngIf="!secondFactorData">
        <div class="w-full mx-auto mx-auto sm:mx-0" style="max-width: 500px;">
            <!-- Logo -->
            <div class="w-full grid grid-cols-4">
                <div class="w-12">
                    <img [src]="project.branding.logo">
                </div>

                <div class="mt-3 text-2xl font-extrabold tracking-tight leading-tight col-span-3">{{project.name}}</div>
            </div>

            <!-- Title -->
            <div class="mt-8 text-4xl font-extrabold tracking-tight leading-tight">
                {{ 'login.title_1' | transloco }},<br>
                {{ 'login.title_2' | transloco }}
            </div>

            <div class="flex items-baseline mt-0.5 font-medium">
                <div>{{ 'login.no_account' | transloco }} </div>
                <a class="ml-1 text-primary-500 hover:underline"
                    [routerLink]="['/kyc/project/', project._id]">{{ 'login.register_here_link' | transloco }}</a>
            </div>

            <!-- Error -->
            <fuse-alert class="mt-8 -mb-4" *ngIf="showAlert" [appearance]="'outline'" [showIcon]="false"
                [type]="alert.type" [@shake]="alert.type === 'error'">
                {{'errors.' + alert.message | transloco}}
            </fuse-alert>

            <!-- Sign Up form -->
            <form class="mt-8" [formGroup]="signInForm">

                <mat-tab-group selectedIndex="{{typeLogin =='email' ? 0 : 1}}"
                    (selectedTabChange)="selectLogin($event);">
                    <mat-tab label="{{ 'login.email' | transloco}}" disabled="{{!projectFlow.email}}">
                        <ng-template matTabContent>
                            <!-- email -->
                            <mat-form-field class="w-full mt-4">
                                <mat-label>{{ 'login.email' | transloco}}</mat-label>

                                <input id="email" matInput [formControlName]="'email'">
                                
                                <mat-error *ngIf="signInForm.get('email').hasError('required')" class="p-1">
                                    {{ 'login.required_email' | transloco}}
                                </mat-error>
                                
                                <mat-error *ngIf="signInForm.get('email').hasError('email')" class="p-1">
                                    {{ 'login.invalid_email' | transloco}}
                                </mat-error>
                            </mat-form-field>

                            <!-- OTP -->
                            <mat-form-field class="w-full" *ngIf="emailSent">
                                <mat-label>{{ 'login.email_otp' | transloco}}</mat-label>
                                <input id="emailOTP" matInput type="password" [formControlName]="'emailOTP'"
                                    #passwordField>
                                <button mat-icon-button type="button"
                                    (click)="passwordField.type === 'password' ? passwordField.type = 'text' : passwordField.type = 'password'"
                                    matSuffix>
                                    <mat-icon class="icon-size-5" *ngIf="passwordField.type === 'password'"
                                        [svgIcon]="'heroicons_solid:eye'"></mat-icon>
                                    <mat-icon class="icon-size-5" *ngIf="passwordField.type === 'text'"
                                        [svgIcon]="'heroicons_solid:eye-off'"></mat-icon>
                                </button>
                                <mat-error>
                                    OTP is required
                                </mat-error>
                            </mat-form-field>
                        </ng-template>
                    </mat-tab>
                    <mat-tab label="{{ 'login.phone' | transloco}}" disabled="{{!projectFlow.phone}}">
                        <ng-template matTabContent>
                            <!-- phone-->
                            <div class="grid grid-flow-col mt-4" *ngIf="groupFields.phone">
                                <mat-form-field class="w-120px">
                                    <mat-label>{{ 'login.country_code' | transloco}}</mat-label>
                                    <mat-select *ngIf="countries" [formControl]="signInForm.get('countryCode')"
                                        matPrefix>
                                        <mat-select-trigger>
                                            <span class="flex items-center">
                                                <span
                                                    class="sm:mx-0.5 font-medium text-default">{{ signInForm.get('countryCode').value }}</span>
                                            </span>
                                        </mat-select-trigger>
                                        <ng-container *ngFor="let country of countries; trackBy: trackByFn">
                                            <mat-option [value]="country.code">
                                                <span class="flex items-center">
                                                    <span class="ml-2">{{country.name}}</span>
                                                    <span class="ml-2 font-medium">{{country.code}}</span>
                                                </span>
                                            </mat-option>
                                        </ng-container>
                                    </mat-select>
                                </mat-form-field>
                                <mat-form-field class="w-full col-span-3" *ngIf="groupFields.phone">
                                    <mat-label>{{ 'login.phone' | transloco}}</mat-label>
                                    <input id="phone" matInput [formControlName]="'phone'">
                                    
                                    <mat-error *ngIf="signInForm.get('phone').hasError('required')" class="p-1">
                                        {{ 'login.required_phone' | transloco}}
                                    </mat-error>

                                    <mat-error *ngIf="signInForm.get('phone').hasError('phone')" class="p-1">
                                        {{ 'login.invalid_phone' | transloco}}
                                    </mat-error>
                                </mat-form-field>

                            </div>
                            <!-- phoneOTP -->
                            <mat-form-field class="w-full" *ngIf="smsSent">
                                <mat-label> {{ 'login.phone_otp' | transloco}}</mat-label>
                                <input id="phoneOTP" matInput type="password" [formControlName]="'phoneOTP'"
                                    #passwordField>
                                <button mat-icon-button type="button"
                                    (click)="passwordField.type === 'password' ? passwordField.type = 'text' : passwordField.type = 'password'"
                                    matSuffix>
                                    <mat-icon class="icon-size-5" *ngIf="passwordField.type === 'password'"
                                        [svgIcon]="'heroicons_solid:eye'"></mat-icon>
                                    <mat-icon class="icon-size-5" *ngIf="passwordField.type === 'text'"
                                        [svgIcon]="'heroicons_solid:eye-off'"></mat-icon>
                                </button>
                                <mat-error class="p-1">
                                    {{ 'login.code_is_required' | transloco}}
                                </mat-error>
                            </mat-form-field>
                        </ng-template>
                    </mat-tab>
                </mat-tab-group>

                <div class="flex flex-col flex-auto  w-full items-center sm:justify-center">

                    <!-- Submit button -->
                    <button class="fuse-mat-button-large w-full" mat-flat-button [color]="'primary'"
                        [disabled]="!isFormValid()" (click)="signIn()" *ngIf="!activeSendOtp">
                        <span *ngIf="!signInForm.disabled">
                            {{ 'login.login_button' | transloco }}
                        </span>
                        <mat-progress-spinner *ngIf="signInForm.disabled" [diameter]="24" [mode]="'indeterminate'">
                        </mat-progress-spinner>
                    </button>

                    <!-- SEND OTP -->
                    <button mat-stroked-button class="w-full mt-4" color="primary" (click)="sendOTP($event);"
                        [disabled]="!activeSendOtp">
                        <span *ngIf="activeSendOtp">
                            {{ 'login.send_otp' | transloco }}
                        </span>

                        <mat-progress-spinner *ngIf="!activeSendOtp" [diameter]="12" [mode]="'indeterminate'">
                        </mat-progress-spinner>

                        <span *ngIf="typeLogin=='phone' && smsSent">
                            ({{phoneValidation.diff}}) s
                        </span>
                        <span *ngIf="typeLogin=='email' && emailSent">
                            ({{emailValidation.diff}}) s
                        </span>

                    </button>

                    <h3 class="m-2" *ngIf="projectFlow.faceLiveness">O</h3>

                    <!-- SEND BIOMETRIC -->
                    <button mat-stroked-button class="w-full" [disabled]="!canUseBiometrics()" color="primary"
                        (click)="startBiometric()" *ngIf="projectFlow.faceLiveness">
                        <span>
                            {{ 'login.use_biometrics_button' | transloco }}
                        </span>

                        <mat-progress-spinner *ngIf="!biometricsReady" [diameter]="12" [mode]="'indeterminate'">
                        </mat-progress-spinner>
                    </button>
                </div>


            </form>

            <div class="w-full text-center mt-6">
                <languages></languages>
            </div>

        </div>
    </div>

    <div class="w-full sm:w-auto py-8 px-4 sm:p-12 sm:rounded-2xl sm:shadow sm:bg-card mx-auto main-card"
        *ngIf="secondFactorData && secondFactorForm">
        <div class="w-full mx-auto mx-auto sm:mx-0">
            <!-- Logo -->
            <div class="w-full grid grid-cols-4">
                <div class="w-12">
                    <img [src]="project.branding.logo">
                </div>

                <div class="mt-3 text-2xl font-extrabold tracking-tight leading-tight col-span-3">{{project.name}}</div>
            </div>

            <!--  -->
            <div class="m-5 text-center">

                <h2 class="m-2 verifikH3" *ngIf="secondFactorData.QRCode">
                    {{ 'login.two_factor_title' | transloco }}
                </h2>

                <p *ngIf="secondFactorData.QRCode">
                    {{ 'login.two_factor_description_1' | transloco }} <a href="https://authy.com/download/">Authy</a>, <a href="https://support.google.com/accounts/answer/1066447?hl=en&co=GENIE.Platform%3DiOS">Google Authenticator</a> {{ 'login.two_factor_description_2' | transloco }}
                </p>

                <!-- no QR code found -->

                <h2 class="m-2 verifikH3" *ngIf="!secondFactorData.QRCode">
                    {{ 'login.two_factor_second_time_title' | transloco }}
                </h2>

                <p *ngIf="!secondFactorData.QRCode">
                    {{ 'login.two_factor_second_time_description' | transloco }}
                </p>

                <!-- end of no QR Code -->

                <img [src]="secondFactorData.QRCode" alt="">

                <h2 class="m-2 verifikH3">
                    {{secondFactorData.secretKey}}
                </h2>

                <form class="" [formGroup]="secondFactorForm">
                    <mat-form-field class="w-full mt-4">
                        <mat-label>{{ 'login.two_factor_label' | transloco}}</mat-label>
                        <input id="authenticatorOTP" matInput [formControlName]="'authenticatorOTP'">

                        <mat-error *ngIf="secondFactorForm.get('authenticatorOTP').hasError('required')" class="p-1">
                            {{ 'login.required_authenticator_otp' | transloco}}
                        </mat-error>

                    </mat-form-field>
                </form>

                <button mat-stroked-button class="w-full mt-4 mainVerifikButton" color="primary"
                    (click)="signIn()" [disabled]="!secondFactorForm.valid">
                    <span>
                        {{ 'login.login_button' | transloco }}
                    </span>
                </button>

            </div>

        </div>

        <div class="w-full text-center mt-6">
            <languages></languages>
        </div>
    </div>
</div>