<div
	fxLayout="column"
	fxLayoutAlign="center center"
	class="bg-white rounded-lg shadow-lg m-5 p-4 w-full"
	*ngIf="!response.isFailed && camera.hasPermissions"
>
	<div class="relative" 
	[style.width.px]="camera.dimensions.video.width"
	[style.height.px]="camera.dimensions.video.height"
	>
		<webcam
			[height]="camera.dimensions.video.max.height"
			[width]="camera.dimensions.video.max.width"
			[videoOptions]="camera.configuration"
			[imageQuality]="1"
			[captureImageData]="true"
			[allowCameraSwitch]="false"
			[trigger]="takePicture$"
			[mirrorImage]="demoData.isMobile ? 'never' : 'always'"
			(imageCapture)="proccessImage($event)"
			(initError)="cameraError($event)"
			*ngIf="!response.base64Image"
		></webcam>
		<canvas
			#maskResult
			class="absolute top-0 left-0"
			[style.width.px]="response.base64Image ? camera.dimensions.result.width : camera.dimensions.video.width"
			[style.height.px]="response.base64Image ? camera.dimensions.result.height : camera.dimensions.video.height"
		></canvas>
		<canvas #toSend [class.hidden]="true"></canvas>
	</div>
	<div fxLayout="row" fxLayoutAlign="center center">
		<button mat-raised-button color="primary" class="m-4 z-index-2" [class.hidden]="response.base64Image" (click)="takePictureSnapshot()">
			{{ "id_scanning.manual_capture_button" | transloco }}
		</button>

		<button mat-stroked-button color="primary" class="m-4 z-index-2" [class.hidden]="!response.base64Image" (click)="ngOnInit()">
			{{ "id_scanning.retry" | transloco }}
		</button>

		<button mat-raised-button color="primary" class="mx-2" [class.hidden]="!response.base64Image" (click)="continue()">
			{{ "continue" | transloco }}
		</button>
	</div>
</div>

<!-- it doesnt have permissions -->
<div
	*ngIf="!response.isFailed && !camera.hasPermissions && !camera.isLoading"
	fxLayout="column"
	fxLayoutAlign="center center"
	class="id-scanning-error-div"
>
	<img src="https://cdn.verifik.co/demo/nocameraenabled.svg" alt="" class="id-scanning-no-camera-enabled-img" />

	<h1 class="mt-4">{{ "id_scanning.camera_not_found" | transloco }}</h1>

	<p class="mt-4">
		{{ "id_scanning.camera_not_found_description" | transloco }}
	</p>
</div>

<div *ngIf="response.isFailed" fxLayout="column" fxLayoutAlign="center center" class="id-scanning-error-div">
	<img
		[src]="
			attempts.limit - attempts.current > 0
				? 'https://cdn.verifik.co/demo/failedtodetectdocument@3x.png'
				: 'https://cdn.verifik.co/demo/redstop.svg'
		"
		alt=""
		class="id-scanning-failed-document-img"
	/>

	<h1 class="mt-4">
		{{ (attempts.limit - attempts.current > 0 ? "id_scanning.document_not_detected" : "id_scanning.failed_to_detect_limit") | transloco }}
	</h1>

	<p class="mt-4">
		{{
			(attempts.limit - attempts.current > 0
				? "id_scanning.document_not_detected_description"
				: "id_scanning.failed_to_detect_limit_description"
			) | transloco
		}}
	</p>

	<p class="mt-4" *ngIf="attempts.limit - attempts.current > 0">
		{{ "id_scanning.remaining_attempts" | transloco }} {{ attempts.limit - attempts.current }}
	</p>

	<button
		mat-raised-button
		color="primary"
		class="mt-4 z-index-2 id-scanning-try-again-button"
		(click)="attempts.limit - attempts.current > 0 ? tryAgain() : restartDemo()"
	>
		{{ (failedToDetectDocument ? "id_scanning.retry" : "restart") | transloco }}
	</button>
</div>
