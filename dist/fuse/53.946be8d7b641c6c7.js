"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[53],{5810:(y,f,o)=>{o.r(f),o.d(f,{default:()=>B});var g=o(4748),C=o(553),_=o(8533),v=o(6814),w=o(1447),u=o(8991),c=o(6223),s=o(2296),l=o(5986),d=o(1043),m=o(617),x=o(4516),h=o(5940),R=o(4913),b=o(6321),V=o(4825),j=o(6676),U=o.n(j),k=o(6420),t=o(5879),F=o(8340),q=o(6036),Z=o(3403),T=o(3814);const I=["otpNgForm"];function Y(e,a){1&e&&t._UZ(0,"mat-icon",20),2&e&&t.Q6J("svgIcon","heroicons_solid:eye")}function L(e,a){1&e&&t._UZ(0,"mat-icon",20),2&e&&t.Q6J("svgIcon","heroicons_solid:eye-slash")}function E(e,a){1&e&&(t.TgZ(0,"mat-error",21),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"login.required_otp")," "))}function K(e,a){if(1&e&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&e){const i=t.oxw(2);t.xp6(1),t.hij(" Time remaining: ",i.remainingTime," ")}}function N(e,a){1&e&&(t.TgZ(0,"span"),t._uU(1,"Resend the"),t.qZA())}function J(e,a){if(1&e){const i=t.EpF();t.TgZ(0,"a",22),t.NdJ("click",function(){t.CHM(i);const r=t.oxw(2);return t.KtG(r._initValidations())}),t._uU(1,"verification code"),t.qZA()}}const M=function(e){return{destination:e}};function P(e,a){if(1&e){const i=t.EpF();t.TgZ(0,"div",4)(1,"div",5)(2,"div",6),t._UZ(3,"img",7),t.qZA(),t.TgZ(4,"div",8),t._uU(5),t.ALo(6,"transloco"),t.qZA(),t.TgZ(7,"form",9,10)(9,"mat-form-field",11)(10,"mat-label"),t._uU(11,"OTP"),t.qZA(),t.TgZ(12,"input",12,13),t.NdJ("input",function(r){t.CHM(i);const p=t.oxw();return t.KtG(p.onInput(r))})("keyup",function(){t.CHM(i);const r=t.oxw();return t.KtG(r.checkSixDigits())}),t.qZA(),t.TgZ(14,"button",14),t.NdJ("click",function(){t.CHM(i);const r=t.MAs(13);return t.KtG(r.type="password"===r.type?"text":"password")}),t.YNc(15,Y,1,1,"mat-icon",15),t.YNc(16,L,1,1,"mat-icon",15),t.qZA(),t.YNc(17,E,3,3,"mat-error",16),t.qZA()(),t.TgZ(18,"div",17),t.YNc(19,K,2,1,"span",18),t.YNc(20,N,2,0,"span",18),t.YNc(21,J,2,0,"a",19),t.qZA()()()}if(2&e){const i=t.MAs(13),n=t.oxw();t.xp6(3),t.Q6J("src",n.project.branding.logo,t.LSH),t.xp6(2),t.hij(" ",t.xi3(6,10,"signup.verify_code_sent",t.VKq(13,M,n.currentValidation.email||n.currentValidation.countryCode+" "+n.currentValidation.phone))," "),t.xp6(2),t.Q6J("formGroup",n.otpForm),t.xp6(5),t.Q6J("formControlName","otp"),t.xp6(3),t.Q6J("ngIf","password"===i.type),t.xp6(1),t.Q6J("ngIf","text"===i.type),t.xp6(1),t.Q6J("ngIf",n.otpForm.get("otp").hasError("required")),t.xp6(2),t.Q6J("ngIf","Expired"!==n.remainingTime),t.xp6(1),t.Q6J("ngIf","Expired"===n.remainingTime),t.xp6(1),t.Q6J("ngIf","Expired"===n.remainingTime)}}function Q(e,a){if(1&e&&(t.TgZ(0,"div",4)(1,"div",5)(2,"div",23),t._uU(3),t.ALo(4,"transloco"),t.qZA()()()),2&e){const i=t.oxw();t.xp6(3),t.hij(" ",t.lcZ(4,1,"signup.error_"+i.errorContent.message)," ")}}function O(e,a){if(1&e){const i=t.EpF();t.TgZ(0,"div",5)(1,"div",28),t._UZ(2,"img",29),t.TgZ(3,"h2",30),t._uU(4),t.ALo(5,"transloco"),t.qZA(),t.TgZ(6,"h3",31),t._uU(7),t.ALo(8,"transloco"),t.qZA()(),t.TgZ(9,"div",32)(10,"button",33),t.NdJ("click",function(){t.CHM(i);const r=t.oxw(2);return t.KtG(r.startKYC())}),t.TgZ(11,"span"),t._uU(12),t.ALo(13,"transloco"),t.qZA()(),t.TgZ(14,"button",33),t.NdJ("click",function(){t.CHM(i);const r=t.oxw(2);return t.KtG(r.continueWitoutKYC())}),t.TgZ(15,"span"),t._uU(16),t.ALo(17,"transloco"),t.qZA()()(),t.TgZ(18,"div",27),t._UZ(19,"languages"),t.qZA()()}if(2&e){const i=t.oxw(2);t.xp6(4),t.hij(" ",t.lcZ(5,8,"add_biometrics.verifik_title")," "),t.xp6(3),t.Oqu(t.lcZ(8,10,"add_biometrics.verifik_content")),t.xp6(4),t.Udp("color",i.project.branding.txtColor),t.xp6(1),t.hij("",t.lcZ(13,12,"add_biometrics.verifik_button")," "),t.xp6(3),t.Udp("color",i.project.branding.txtColor),t.xp6(1),t.hij(" ",t.lcZ(17,14,"add_biometrics.verifik_dismiss")," ")}}function D(e,a){if(1&e){const i=t.EpF();t.TgZ(0,"div",34)(1,"div",28)(2,"h1",35),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t._UZ(5,"img",36)(6,"img",37),t.TgZ(7,"h2",38),t._uU(8),t.ALo(9,"transloco"),t.qZA(),t.TgZ(10,"h3",39),t._uU(11),t.ALo(12,"transloco"),t.qZA()(),t.TgZ(13,"div",32)(14,"button",33),t.NdJ("click",function(){t.CHM(i);const r=t.oxw(2);return t.KtG(r.startKYC())}),t.TgZ(15,"span"),t._uU(16),t.ALo(17,"transloco"),t.qZA()(),t.TgZ(18,"button",33),t.NdJ("click",function(){t.CHM(i);const r=t.oxw(2);return t.KtG(r.continueWitoutKYC())}),t.TgZ(19,"span"),t._uU(20),t.ALo(21,"transloco"),t.qZA()()()()}if(2&e){const i=t.oxw(2);t.xp6(2),t.Udp("color",i.project.branding.titleColor),t.xp6(1),t.AsE(" ",t.lcZ(4,12,"signup.kyc_start_popup.project_title")," ",i.project.name," "),t.xp6(5),t.hij(" ",t.lcZ(9,14,"signup.kyc_start_popup.title")," "),t.xp6(3),t.Oqu(t.lcZ(12,16,"signup.kyc_start_popup.content")),t.xp6(4),t.Udp("color",i.project.branding.txtColor),t.xp6(1),t.hij("",t.lcZ(17,18,"add_biometrics.button")," "),t.xp6(3),t.Udp("color",i.project.branding.txtColor),t.xp6(1),t.hij(" ",t.lcZ(21,20,"add_biometrics.dismiss")," ")}}function G(e,a){if(1&e&&(t.TgZ(0,"div",24),t.YNc(1,O,20,16,"div",25),t.YNc(2,D,22,22,"div",26),t.TgZ(3,"div",27),t._UZ(4,"languages"),t.qZA()()),2&e){const i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.isVerifikProject),t.xp6(1),t.Q6J("ngIf",!i.isVerifikProject)}}function H(e,a){1&e&&(t.TgZ(0,"div",40),t._UZ(1,"div",41),t.qZA())}const B=[{path:":id",component:(()=>{class e{constructor(i,n,r,p,A,z){this._KYCService=i,this._splashScreenService=n,this._activatedRoute=r,this._changeDetectorRef=p,this._router=A,this._formBuilder=z,this._splashScreenService.show(),localStorage.removeItem("accessToken")}ngOnInit(){this._initForm(),this._activatedRoute.params.subscribe(i=>{this.isVerifikProject=i.id===C.N.verifikProject;const n=this._router.url.split("?token=")[1];localStorage.setItem("accessToken",n),this._requestAppRegistration()})}_requestAppRegistration(){this._KYCService.getAppRegistration({populates:["project","projectFlow","emailValidation","phoneValidation"]}).subscribe({next:i=>{this.appRegistration=i.data,this.project=new _.XR(this.appRegistration.project),this.projectFlow=new _.nd(this.appRegistration.projectFlow)},error:i=>{this.errorContent=i.error,this._splashScreenService.hide()},complete:()=>{this._splashScreenService.hide(),this._initValidations()}})}_initValidations(){this.currentValidation=null,setTimeout(()=>{this._initEmailValidation(),this._initPhoneValidation(),this._completeAppRegistration()},500)}_initEmailValidation(){"mailgun"===this.projectFlow.onboardingSettings.signUpForm.emailGateway&&"validated"!==this.appRegistration.emailValidation?.status&&(this.loading||(this.loading=!0,this._splashScreenService.show(),this._KYCService.sendEmailValidation(this.appRegistration.email).subscribe({next:i=>{this.currentValidation=i.data,this._linkValidation(),this.startCountdown(),this.loading=!1,this._splashScreenService.hide()},error:i=>{this.errorContent=i.error,this._splashScreenService.hide()},complete:()=>{}})))}_initPhoneValidation(){["whatsapp","sms","both"].includes(this.projectFlow.onboardingSettings.signUpForm.phoneGateway)&&"validated"!==this.appRegistration.phoneValidation?.status&&(this.loading||(this.loading=!0,this._splashScreenService.show(),this._KYCService.sendPhoneValidation(this.appRegistration.countryCode,this.appRegistration.phone).subscribe({next:i=>{this.currentValidation=i.data,this._linkValidation(),this.startCountdown(),this.loading=!1,this._splashScreenService.hide()},error:i=>{this.errorContent=i.error,this.loading=!1,this._splashScreenService.hide()},complete:()=>{this.loading=!1,this._splashScreenService.hide()}})))}_initForm(){this.otpForm=this._formBuilder.group({otp:["",[c.kI.required]]})}startCountdown(){this.countdownSubscription&&this.countdownSubscription.unsubscribe();const i=new Date(U()().add(2,"minute").format("YYYY-MM-DD HH:mm:ss")).getTime();this.countdownSubscription=function S(e=0,a=b.z){return e<0&&(e=0),(0,V.H)(e,e,a)}(1e3).subscribe(()=>{let n=(new Date).getTime(),r=i-n;if(r<0)return this.remainingTime="Expired",void this.countdownSubscription.unsubscribe();let p=Math.floor(r%36e5/6e4),A=Math.floor(r%6e4/1e3);this.remainingTime=`${p}m ${A}s`})}onInput(i){const n=i.target;n.value=n.value.replace(/[^0-9]/g,"")}checkSixDigits(){6===this.otpForm.value.otp?.length&&this.confirmValidation()}confirmValidation(){this.loading||(this.loading=!0,this._splashScreenService.show(),this.currentValidation.email?this._confirmEmailValidation():this.currentValidation.phone&&this._confirmPhoneValidation())}_confirmEmailValidation(){this._KYCService.confirmEmailValidation(this.appRegistration.email,this.otpForm.value.otp).subscribe({next:i=>{this.appRegistration.emailValidation=i.data},error:i=>{this.otpForm.reset(),this.loading=!1,this._splashScreenService.hide()},complete:()=>{this.otpForm.reset(),this.loading=!1,this._splashScreenService.hide(),this._initValidations()}})}_confirmPhoneValidation(){this._KYCService.confirmPhoneValidation(this.currentValidation.countryCode,this.currentValidation.phone,this.otpForm.value.otp).subscribe({next:i=>{this.appRegistration.phoneValidation=i.data},error:i=>{this.otpForm.reset()},complete:()=>{this.otpForm.reset(),this.loading=!1,this._splashScreenService.hide(),this._initValidations()}})}_linkValidation(){const i={};this.currentValidation.email?(i.emailValidation=this.currentValidation._id,this.appRegistration.emailValidation=this.currentValidation):this.currentValidation.phone&&(i.phoneValidation=this.currentValidation._id,this.appRegistration.phoneValidation=this.currentValidation),this._KYCService.updateAppRegistration(i).subscribe({next:n=>{},error:n=>{console.error({exception:n})},complete:()=>{}})}_completeAppRegistration(){"mailgun"===this.projectFlow.onboardingSettings.signUpForm.emailGateway&&!this.appRegistration.emailValidation||["whatsapp","sms","both"].includes(this.projectFlow.onboardingSettings.signUpForm.phoneGateway)&&!this.appRegistration.phoneValidation||this.loading||this._KYCService.syncAppRegistration("signUpForm").subscribe({next:i=>{this.syncResponse=i.data},error:()=>{},complete:()=>{}})}startKYC(){this._router.navigate(["/kyc"],{queryParams:{token:this.syncResponse.token}})}continueWitoutKYC(){window.location.href=`${this.projectFlow.redirectUrl}/sign-in?type=onboarding&token=${this.syncResponse.token}`}ngOnDestroy(){this.countdownSubscription&&this.countdownSubscription.unsubscribe()}static#t=this.\u0275fac=function(n){return new(n||e)(t.Y36(F.H),t.Y36(q.j),t.Y36(Z.gz),t.Y36(t.sBO),t.Y36(Z.F0),t.Y36(c.QS))};static#i=this.\u0275cmp=t.Xpm({type:e,selectors:[["auth-confirmation-required"]],viewQuery:function(n,r){if(1&n&&t.Gf(I,5),2&n){let p;t.iGM(p=t.CRH())&&(r.otpNgForm=p.first)}},standalone:!0,features:[t.jDz],decls:5,vars:4,consts:[[1,"flex","flex-col","sm:flex-row","items-center","md:items-start","sm:justify-center","md:justify-start","flex-auto","min-w-0"],["class","md:flex md:items-center md:justify-end w-full sm:w-auto md:h-full md:w-1/2 py-8 px-4 sm:p-12 md:p-16 sm:rounded-2xl md:rounded-none sm:shadow md:shadow-none sm:bg-card",4,"ngIf"],["class","md:flex md:items-center md:justify-center w-full sm:w-auto md:h-full md:w-1/2 py-8 px-4 sm:p-12 md:p-16 sm:rounded-2xl md:rounded-none sm:shadow md:shadow-none sm:bg-card","fxLayout","column","fxLayoutAlign","start center",4,"ngIf"],["class","relative hidden md:flex flex-auto items-center justify-center w-1/2 h-full p-16 lg:px-28 overflow-hidden bg-gray-800 dark:border-l",4,"ngIf"],[1,"md:flex","md:items-center","md:justify-end","w-full","sm:w-auto","md:h-full","md:w-1/2","py-8","px-4","sm:p-12","md:p-16","sm:rounded-2xl","md:rounded-none","sm:shadow","md:shadow-none","sm:bg-card"],[1,"w-full","max-w-80","sm:w-80","mx-auto","sm:mx-0"],[1,"w-12"],[3,"src"],[1,"mt-8","text-2xl","font-extrabold","tracking-tight","leading-tight"],[1,"mt-8",3,"formGroup"],["otpNgForm","ngForm"],[1,"w-full"],["id","otp","matInput","","type","password",3,"formControlName","input","keyup"],["passwordField",""],["mat-icon-button","","type","button","matSuffix","",3,"click"],["class","icon-size-5",3,"svgIcon",4,"ngIf"],["class","p-1",4,"ngIf"],[1,"mt-2","text-md","font-medium","text-secondary"],[4,"ngIf"],["class","ml-1 text-primary-500 hover:underline cursor-pointer",3,"click",4,"ngIf"],[1,"icon-size-5",3,"svgIcon"],[1,"p-1"],[1,"ml-1","text-primary-500","hover:underline","cursor-pointer",3,"click"],[1,"mt-8","text-4xl","font-extrabold","tracking-tight","leading-tight"],["fxLayout","column","fxLayoutAlign","start center",1,"md:flex","md:items-center","md:justify-center","w-full","sm:w-auto","md:h-full","md:w-1/2","py-8","px-4","sm:p-12","md:p-16","sm:rounded-2xl","md:rounded-none","sm:shadow","md:shadow-none","sm:bg-card"],["class","w-full max-w-80 sm:w-80 mx-auto sm:mx-0",4,"ngIf"],["class","w-full max-w-80 sm:w-80 mx-auto sm:mx-0","fxLayout","column","fxLayoutAlign","start center",4,"ngIf"],[1,"w-full","text-center","mt-6"],["fxLayout","column","fxLayoutAlign","start center"],["src","https://cdn.verifik.co/access/goldcoins3x.png","alt","",1,"w-36"],[1,"pt-2","credits-h2"],[1,"credits-h3"],["fxLayout","column","fxLayoutAlign","center center",1,"w-full"],["mat-stroked-button","","color","primary",1,"w-11/12","mt-4","biometrics-button",3,"click"],["fxLayout","column","fxLayoutAlign","start center",1,"w-full","max-w-80","sm:w-80","mx-auto","sm:mx-0"],[1,"mt-4","text-4xl","font-extrabold","tracking-tight","leading-tight"],["src","https://cdn.verifik.co/access/divider.svg","alt","",1,"w-full","pb-8","pt-8"],["src","https://cdn.verifik.co/access/biometrics_icon.svg","alt","",1,"w-28"],[1,"pt-2","text-2xl","font-extrabold"],[1,"credits-h3","text-center"],[1,"relative","hidden","md:flex","flex-auto","items-center","justify-center","w-1/2","h-full","p-16","lg:px-28","overflow-hidden","bg-gray-800","dark:border-l"],[1,"z-10","relative","w-full","max-w-2xl"]],template:function(n,r){1&n&&(t.TgZ(0,"div",0),t.YNc(1,P,22,15,"div",1),t.YNc(2,Q,5,3,"div",1),t.YNc(3,G,5,2,"div",2),t.YNc(4,H,2,0,"div",3),t.qZA()),2&n&&(t.xp6(1),t.Q6J("ngIf",r.appRegistration&&r.project&&r.otpForm&&r.currentValidation&&r.currentValidation._id),t.xp6(1),t.Q6J("ngIf",r.errorContent),t.xp6(1),t.Q6J("ngIf",r.syncResponse),t.xp6(1),t.Q6J("ngIf",!r.errorContent))},dependencies:[w.o9,T.xw,T.Wh,v.O5,c.u5,c._Y,c.Fj,c.JJ,c.JL,c.UX,c.sg,c.u,d.lN,d.KE,d.hX,d.TO,d.R9,x.c,x.Nt,s.ot,s.lW,s.RK,m.Ps,m.Hw,l.p9,h.Cq,u.y4,u.Ot,v.ez,R.LD,k.v],encapsulation:2,data:{animation:g.L}})}return e})()}]},2065:(y,f,o)=>{o.d(f,{O:()=>w});var g=o(8075),C=o(4716),_=o(5879),v=o(9862);let w=(()=>{class u{get progress(){return!!this.tail.length}constructor(s){this._http=s,this.tail=[]}sendRequest(s,l,d={},m={}){s=s.toLocaleLowerCase();const x=localStorage.getItem("accessToken");let h={timeout:20};switch(x&&(h.Authorization=`Bearer ${x}`),s){case"get":return this.request(this._http.get(l,{params:d,headers:h,...m}));case"post":return this.request(this._http.post(l,d,{headers:h,...m}));case"put":return this.request(this._http.put(l,d,{headers:h,...m}));case"delete":return this.request(this._http.delete(l,{headers:h,...m}));default:throw"method not provided"}}request(s){return this.tail.push(s),s.pipe((0,g.X)(0),(0,C.x)(()=>{const l=this.tail.indexOf(s);this.tail.splice(l,1)}))}static#t=this.\u0275fac=function(l){return new(l||u)(_.LFG(v.eN))};static#i=this.\u0275prov=_.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},553:(y,f,o)=>{o.d(f,{N:()=>g});const g={production:!0,baseUrl:"/",apiUrl:"",appUrl:"https://app.verifik.co",kycUrl:"https://kyc.verifik.co",verifikProject:"6332941ccde4f719d9c00f9e"}}}]);