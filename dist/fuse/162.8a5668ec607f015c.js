"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[162],{9162:(F,I,c)=>{c.d(I,{e:()=>w});var u=c(5861),v=c(5619),f=c(553),p=c(1088),S=c(6799);class O{constructor(t){if(t){this.documentNumber=t.documentNumber,this.firstName=`${t.firstName||""} ${t.middleName||""}`.trim()||`${t.name1||""} ${t.name2||""} ${t.name3||""}`.trim()||`${t.givenNames||""}`.trim(),this.lastName=`${t.lastName||""} ${t.secondLastName||""}`.trim()||`${t.surname||""}`.trim(),this.fullName=`${this.firstName||""} ${this.lastName||""}`,this.dateOfBirth=t.dateOfBirth,this.country=t.country,this.nationality=t.nationality,this.gender=t.gender||t.sex,this.placeOfBirth=t.placeOfBirth||t.birthPlace,this.issueDate=t.dateOfIssue||t.issueDate,this.expirationDate=t.dateOfExpiry||t.expiryDate||t.expirationDate,this.issuingAuthority=t.issuingAuthority,this.maritalStatus=t.marritalStatus||t.maritalStatus,this.observations=t.observations,this.code=t.code,this.organDonor=t.organDonor,this.bloodType=t.bloodType,this.locationCode=t.locationCode,this.inscriptionDate=t.inscriptionDate,this.notMapped=[];for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(this[e]||this.notMapped.push({key:e,value:t[e]}))}}}class d{constructor(t){if(t){this._id=t._id,this.documentType=t.documentType,this.documentNumber=t.documentNumber,this.url=t.url,this.status=t.status,this.validationMethod=t.validationMethod,this.namesMatch=t.namesMatch,this.OCRExtraction=new O(t.OCRExtraction),this.arrayFields=[{key:"documentType",value:this.documentType}];for(const e in this.OCRExtraction){if(!Object.prototype.hasOwnProperty.call(this.OCRExtraction,e))continue;const o=this.OCRExtraction[e];!o||Array.isArray(o)||this.arrayFields.push({key:e,value:o})}this.scoreValidated=t.scoreValidated,this.scoreValidation=t.scoreValidation}}}class D{constructor(t){this._id=t._id||"new",this.identifier=t.identifier,this.lead=t.lead,this.status=t.status,this.liveness=t.liveness||{},this.comparison=t.comparison||{},this.comparisonResult=t.comparisonResult||[],this.generalInformation=t.generalInformation||{},this.lat=t.lat,this.lng=t.lng}}class y{constructor(t){t&&(this._id=t._id||"new",this.status=t.status||"active",this.phone=t.phone,this.countryCode=t.countryCode,this.name=t.name,this.companyName=t.companyName,this.email=t.email,this.website=t.website,this.jobFunction=t.jobFunction,this.sessionsCount=t.sessionsCount||0,this.sessionsLimit=t.sessionsLimit||10)}}var g=c(5879),N=c(2065);let n=null,w=(()=>{class l{constructor(e,o){this._httpWrapperService=e,this.breakpointObserver=o,this._faceapi=new v.X(null),this._geoLocation=new v.X(null),this.apiUrl=f.N.apiUrl,this.loadModels(),this.initNavigation(),this.initDemoData(),this.initSampleData(),n=this,o.observe([p.u3.XSmall,p.u3.Small]).subscribe(s=>{this.demoData.isMobile=s.matches,this.demoData.time=s.matches?500:250}),this.demoData.OS=this.detectOS()}initSampleData(){f.N.production||(this.sampleLastNames=["Smith","Johnson","Williams","Jones","Brown","Davis","Miller","Wilson","Moore","Taylor","Reynolds","Specter","Litt","Ross","Garc\xeda","Fern\xe1ndez","Gonz\xe1lez","Rodr\xedguez","L\xf3pez","Mart\xednez","S\xe1nchez","P\xe9rez","Mart\xedn","G\xf3mez"],this.sampleFirstNames=["James","John","Robert","Michael","William","David","Richard","Joseph","Thomas","Charles","Mike","Harvey","Jos\xe9","Juan","Miguel","Luis","Antonio","Javier","Francisco","Carlos","Alejandro","Manuel","Rogelio","Alexander"])}detectOS(){const e=window.navigator.userAgent.toLowerCase();return/android/.test(e)?"ANDROID":/iphone|ipad|ipod/.test(e)?"IOS":"DESKTOP"}get faceapi$(){return this._faceapi.asObservable()}get geoLocation$(){return this._geoLocation.asObservable()}loadModels(){var e=this;return(0,u.Z)(function*(){const o=[];o.push(S.qB.ssdMobilenetv1.loadFromUri("assets/models")),o.push(S.qB.faceLandmark68Net.loadFromUri("assets/models")),yield Promise.allSettled(o),e._faceapi.next(!0)})()}getNavigation(){return this.navigation}initNavigation(){this.navigation={currentStep:1,lastStep:5}}getDemoData(){return!this.demoData.proFields?.length&&localStorage.getItem("proFields")&&(this.demoData.pro=new d(JSON.parse(localStorage.getItem("pro"))),this.demoData.proFields=this.demoData.pro.arrayFields),!this.demoData.promptFields?.length&&localStorage.getItem("promptFields")&&(this.demoData.prompt=new d(JSON.parse(localStorage.getItem("prompt"))),this.demoData.promptFields=this.demoData.prompt.arrayFields),!this.demoData.studioFields?.length&&localStorage.getItem("studioFields")&&(this.demoData.studio=new d(JSON.parse(localStorage.getItem("studio"))),this.demoData.studioFields=this.demoData.studio.arrayFields),!this.demoData.liveness?._id&&localStorage.getItem("liveness")&&(this.demoData.liveness=JSON.parse(localStorage.getItem("liveness"))),!this.demoData.livenessResult.length&&localStorage.getItem("livenessResult")&&(this.demoData.livenessResult=JSON.parse(localStorage.getItem("livenessResult"))),!this.demoData.comparison?._id&&localStorage.getItem("comparison")&&(this.demoData.comparison=JSON.parse(localStorage.getItem("comparison"))),!this.demoData.comparisonResult.length&&localStorage.getItem("comparisonResult")&&(this.demoData.comparisonResult=JSON.parse(localStorage.getItem("comparisonResult"))),this.demoData}initDemoData(){this.demoData={loading:!1,liveness:{},comparison:{},livenessResult:[],comparisonResult:[],generalInformation:[],location:[],documentType:{},documentTypeFields:[],pro:{},proFields:[],studio:{},studioFields:[],prompt:{},promptFields:[],lat:null,lng:null}}setDemoDocument(e){this.demoData.proFields=[],this.demoData.promptFields=[],this.demoData.studioFields=[],this.formatAndSaveOCRs(e.pro,"pro"),this.formatAndSaveOCRs(e.studio,"studio"),this.formatAndSaveOCRs(e.prompt,"prompt"),this.demoData.studio?localStorage.setItem("documentId",this.demoData.studio._id):this.demoData.prompt?localStorage.setItem("documentId",this.demoData.prompt._id):this.demoData.pro&&localStorage.setItem("documentId",this.demoData.pro._id)}formatAndSaveOCRs(e,o){const s=`${o}Fields`;if(!e||!e.documentNumber)return localStorage.removeItem(o),void localStorage.removeItem(s);this.demoData[s].push({key:"documentType",value:e.documentType}),this.demoData[s].push({key:"documentNumber",value:e.documentNumber});const a=new d(e);this.demoData[o]=a,this.demoData[s]=a.arrayFields,localStorage.setItem(o,JSON.stringify(e)),localStorage.setItem(s,JSON.stringify(this.demoData[s]))}setDemoLiveness(e){this.demoData.liveness=e,this.demoData.liveness.result.liveness_score=parseInt(""+100*this.demoData.liveness.result.liveness_score),this.demoData.liveness.result.min_score=parseInt(""+100*this.demoData.liveness.result.min_score),this.demoData.livenessResult=[];for(const o in e.result)this.demoData.livenessResult.push({key:o,value:e.result[o]});localStorage.setItem("livenessId",e._id),localStorage.setItem("liveness",JSON.stringify(e)),localStorage.setItem("livenessResult",JSON.stringify(this.demoData.livenessResult))}setDemoCompare(e){this.demoData.comparison=e,this.demoData.comparison.result.score=parseInt(""+100*this.demoData.comparison.result.score);for(const o in e.result)this.demoData.comparisonResult.push({key:o,value:e.result[o]});localStorage.setItem("comparisonId",e._id),localStorage.setItem("comparison",JSON.stringify(e)),localStorage.setItem("comparisonResult",JSON.stringify(this.demoData.comparisonResult))}moveToStep(e){e>this.navigation.lastStep||e<=0||(this.navigation.currentStep=e,localStorage.setItem("step",`${e}`))}restart(){this.cleanVariables(),this.navigation.currentStep=1,localStorage.setItem("step",`${this.navigation.currentStep}`)}getDeviceDetails(){if(this.demoData.generalInformation.length)return;const e={userAgent:navigator.userAgent,platform:navigator.platform,appName:navigator.appName,appVersion:navigator.appVersion,language:navigator.language,onLine:navigator.onLine,cookiesEnabled:navigator.cookieEnabled,doNotTrack:navigator.doNotTrack,screenResolution:`${screen.width} x ${screen.height}`,screenAvailableResolution:`${screen.availWidth} x ${screen.availHeight}`,colorDepth:screen.colorDepth,pixelDepth:screen.pixelDepth,innerWidth:window.innerWidth,innerHeight:window.innerHeight,outerWidth:window.outerWidth,outerHeight:window.outerHeight,touchSupported:"ontouchstart"in window,geolocationSupported:"geolocation"in navigator,onlineStatus:navigator.onLine?"Online":"Offline"};return this.demoData.generalInformation.push({key:"device",value:e.platform},{key:"language",value:e.language},{key:"userAgent",value:e.userAgent}),this.getLocation(),e}getLocation(){localStorage.removeItem("locationError");const e=localStorage.getItem("lat"),o=localStorage.getItem("lng");e&&o&&n._geoLocation.next({lat:e,lng:o}),navigator.geolocation?navigator.geolocation.getCurrentPosition(this.showPosition,this.showError):console.info("Geolocation is not supported by this browser.")}showPosition(e){!n._geoLocation||!e?.coords||(n.demoData.lat=e?.coords.latitude,n.demoData.lng=e?.coords.longitude,localStorage.setItem("lat",n.demoData.lat),localStorage.setItem("lng",n.demoData.lng),n._geoLocation.next({lat:e?.coords.latitude,lng:e?.coords.longitude}))}showError(e){let o="";switch(e.code){case e.PERMISSION_DENIED:o="geolocation.user_denied_request";break;case e.POSITION_UNAVAILABLE:o="geolocation.information_unavailable";break;case e.TIMEOUT:o="geolocation.request_timeout";break;case e.UNKNOWN_ERROR:o="geolocation.unknown_error";break;default:return null}localStorage.setItem("locationError",o),n._geoLocation.next({errorMessage:o})}reverseGeocodeWithOSM(e,o){return(0,u.Z)(function*(){const s=`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e}&lon=${o}`;try{const i=yield(yield fetch(s)).json();return i&&i.display_name?i:null}catch(a){return console.error("Error during reverse geocoding with OSM:",a),null}})()}getAddress(){var e=this;return(0,u.Z)(function*(){const o=e.demoData.lat||localStorage.getItem("lat"),s=e.demoData.lng||localStorage.getItem("lng");if(!o||!s)return null;if(e.demoData.location.length)return e.demoData.location;let a=localStorage.getItem("location");if(a)return void(e.demoData.location=JSON.parse(a));const i=yield e.reverseGeocodeWithOSM(o,s);if(i){for(const r in i.address)Object.prototype.hasOwnProperty.call(i.address,r)&&e.demoData.location.push({key:r,value:i.address[r]});return localStorage.setItem("location",JSON.stringify(e.demoData.location)),e.demoData.location}})()}extractLocationFromLatLng(e,o){var s=this;return(0,u.Z)(function*(){const a=localStorage.getItem("appLocation");if(a)return JSON.parse(a);const i=yield s.reverseGeocodeWithOSM(e,o);if(!i)return;const r={lat:e,lng:o};for(const m in i.address)Object.prototype.hasOwnProperty.call(i.address,m)&&(r[m]=i.address[m]);const h=s.generateUniqueId();return r.deviceIdentifier=h.hash,r.userAgent=h.userAgent,localStorage.setItem("appLocation",JSON.stringify(r)),r})()}getLead(){if(this.lead)return this.lead;const e=localStorage.getItem("lead");return e?(this.lead=new y(JSON.parse(e)),this.lead):null}setLead(e){localStorage.setItem("accessToken",e.token),this.lead=new y(e),localStorage.setItem("lead",JSON.stringify(this.lead))}getSession(){if(this.session)return this.session;const e=localStorage.getItem("session");return e?(this.session=new D(JSON.parse(e)),this.session):null}getBiggestFace(e){let s,o=0;for(const a of e){const i=a.width*a.height;i>o&&(s=a,o=i)}return s}cutFaceIdCard(e,o,s){const a=s.getContext("2d");let i=Math.ceil(2*o.width),r=Math.ceil(2*o.height),h=Math.floor(o.x)-o.width/2,m=Math.floor(o.y)-o.height/2;return i>e.naturalWidth&&(i=e.naturalWidth,r=e.naturalHeight,h=0,m=0),s.height=r,s.width=i,a.drawImage(e,h,m,i,r,0,0,i,r),s.toDataURL("image/jpeg")}setSession(e){this.session=new D(e),localStorage.setItem("session",JSON.stringify(this.session))}requestDocument(e){return this._httpWrapperService.sendRequest("get",`${this.apiUrl}/v2/document-validations/demo/${e}`)}sendDocument(e){return this._httpWrapperService.sendRequest("post",`${this.apiUrl}/v2/ocr/scan-demo`,e)}sendSelfie(e){return this._httpWrapperService.sendRequest("post",`${this.apiUrl}/v2/face-recognition/liveness/demo`,e)}detectFace(e){return this._httpWrapperService.sendRequest("post",`${this.apiUrl}/v2/face-recognition/detect/demo`,e)}compareDocumentWithSelfie(e){return this._httpWrapperService.sendRequest("post",`${this.apiUrl}/v2/face-recognition/compare/demo`,e)}createLead(e){return this._httpWrapperService.sendRequest("post",`${this.apiUrl}/v2/leads`,e)}createSession(e){return this._httpWrapperService.sendRequest("post",`${this.apiUrl}/v2/liveness-sessions`,{...e})}cleanVariables(){const e=["documentId","pro","studio","prompt","proFields","studioFields","promptFields","extractedData","liveness","livenessId","livenessResult","comparison","comparisonResult","comparisonId","idCard","idCardFaceImage","sessionToken"];for(let o=0;o<e.length;o++){const s=e[o];localStorage.removeItem(s),this.demoData[s]&&(this.demoData[s]=Array.isArray(this.demoData[s])?[]:Object.keys(this.demoData[s])?{}:null)}}generateUniqueId(){const e=window.navigator,o=window.screen;return{hash:this.simpleHash(`${e.userAgent}-${e.language}-${e.platform}-${o.height}x${o.width}`),userAgent:e.userAgent,height:o.height,width:o.width}}simpleHash(e){let o=0;if(0===e.length)return o.toString();for(let s=0;s<e.length;s++)o=(o<<5)-o+e.charCodeAt(s),o&=o;return o.toString()}static#e=this.\u0275fac=function(o){return new(o||l)(g.LFG(N.O),g.LFG(p.Yg))};static#t=this.\u0275prov=g.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})()}}]);