"use strict";(self.webpackChunkfuse=self.webpackChunkfuse||[]).push([[330],{8340:(F,A,r)=>{r.d(A,{H:()=>S});var d=r(553),C=r(9397),T=r(8533),x=r(5879),P=r(2065),a=r(8991),D=r(9862);let S=(()=>{class w{constructor(h,v,e){this._httpWrapper=h,this._translocoService=v,this._http=e,this.baseUrl=d.N.apiUrl}getNavigation(){return this.navigation}initNavigation(){let h=1;const v=[],e={},u=this.currentProjectFlow.onboardingSettings.steps;return["mandatory","optional"].includes(u.document)&&(h++,v.push({code:"document",status:u.document}),e.document=u.document,h++,v.push({code:"documentReview",status:u.document}),e.documentReview=u.document),["mandatory","optional"].includes(u.liveness)&&(h++,v.push({code:"liveness",status:u.liveness}),e.liveness=u.liveness,e.document&&(h++,e.documentLivenessReview=u.liveness)),v.push({code:"end",status:"mandatory"}),h++,this.navigation={currentStep:1,lastStep:h,steps:u,map:e,displayableSteps:v},this.navigation}getProject(){return this.currentProject}navigateTo(h){setTimeout(()=>{if("next"!==h)this.navigation.currentStep=h;else switch(this.navigation.currentStep){case"liveness":this.navigation.currentStep="documentLivenessReview";break;case"document":this.navigation.currentStep="documentReview";break;case"documentReview":this.navigation.currentStep="liveness";break;case"documentLivenessReview":this.navigation.currentStep="end"}},750)}getAppRegistration(h){return this._httpWrapper.sendRequest("post",`${this.baseUrl}/v2/app-registrations/me`,h).pipe((0,C.b)(v=>{this.appRegistration=v.data,this.currentProject=new T.XR({...this.appRegistration.project,type:"onboarding"}),this.currentProjectFlow=this.appRegistration.projectFlow}))}createAppRegistration(h){return this._httpWrapper.sendRequest("post",`${this.baseUrl}/v2/app-registrations`,h)}sendEmailValidation(h){return this._httpWrapper.sendRequest("post",`${this.baseUrl}/v2/email-validations`,{email:h,project:this.currentProject._id,projectFlow:this.currentProjectFlow._id,type:"onboarding",validationMethod:"verificationCode",language:this._translocoService.getActiveLang()}).pipe((0,C.b)(v=>{}))}sendPhoneValidation(h,v,e){return this._httpWrapper.sendRequest("post",`${this.baseUrl}/v2/phone-validations`,{countryCode:h,phone:v,project:this.currentProject._id,projectFlow:this.currentProjectFlow._id,type:"onboarding",validationMethod:"verificationCode",language:this._translocoService.getActiveLang(),phoneGateway:e||"sms"}).pipe((0,C.b)(u=>{}))}confirmEmailValidation(h,v){return this._httpWrapper.sendRequest("post",`${this.baseUrl}/v2/email-validations/validate`,{email:h,otp:v,project:this.currentProject._id,projectFlow:this.currentProjectFlow._id})}confirmPhoneValidation(h,v,e){return this._httpWrapper.sendRequest("post",`${this.baseUrl}/v2/phone-validations/validate`,{countryCode:h,phone:v,otp:e,project:this.currentProject._id,projectFlow:this.currentProjectFlow._id})}updateAppRegistration(h){return this._httpWrapper.sendRequest("put",`${this.baseUrl}/v2/app-registrations/${this.appRegistration._id}`,{...h})}syncAppRegistration(h,v){return this._httpWrapper.sendRequest("put",`${this.baseUrl}/v2/app-registrations/${this.appRegistration._id}/sync`,{step:h,status:v})}createDocumentValidation(h){return this._httpWrapper.sendRequest("post",`${this.baseUrl}/v2/document-validations/app-registration`,h)}createBiometricValidation(h){return this._httpWrapper.sendRequest("post",`${this.baseUrl}/v2/biometric-validations/app-registration`,h)}updateInformationValidationWithCriminalRecords(h){return this._httpWrapper.sendRequest("put",`${this.baseUrl}/v2/information-validations/${h._id}/background-check`,h)}updateDocumentValidationNameValidation(h){return this._httpWrapper.sendRequest("put",`${this.baseUrl}/v2/document-validations/${h._id}/validate`,h)}getIdentityImages(h){return this._httpWrapper.sendRequest("get",`${this.baseUrl}/v2/identity-images`,h)}compareFaces(){return this._httpWrapper.sendRequest("post",`${this.baseUrl}/v2/face-recognition/compare/app-registration`,{})}restartKYC(){return this._httpWrapper.sendRequest("delete",`${this.baseUrl}/v2/biometric-validations/${this.appRegistration.biometricValidation._id}`)}static#t=this.\u0275fac=function(v){return new(v||w)(x.LFG(P.O),x.LFG(a.Vn),x.LFG(D.eN))};static#e=this.\u0275prov=x.Yz7({token:w,factory:w.\u0275fac,providedIn:"root"})}return w})()},5789:(F,A,r)=>{r.d(A,{w:()=>a});var d=r(6814),C=r(1447),T=r(8991),x=r(5879),P=r(3814);let a=(()=>{class D{static#t=this.\u0275fac=function(y){return new(y||D)};static#e=this.\u0275cmp=x.Xpm({type:D,selectors:[["app-demo-footer"]],standalone:!0,features:[x.jDz],decls:4,vars:3,consts:[["fxLayout","row","fxLayoutAlign","center center",1,"footer"],["href","https://verifik.co"]],template:function(y,h){1&y&&(x.TgZ(0,"div",0)(1,"a",1),x._uU(2),x.ALo(3,"transloco"),x.qZA()()),2&y&&(x.xp6(2),x.Oqu(x.lcZ(3,1,"footerText")))},dependencies:[C.o9,P.xw,P.Wh,d.ez,T.y4,T.Ot],styles:[".footer[_ngcontent-%COMP%]{width:100%;height:60px;position:absolute;bottom:0;background-color:#fff;box-shadow:3px 3px 3px #0000000d;z-index:3}"]})}return D})()},1094:(F,A,r)=>{r.d(A,{s:()=>z});var d=r(5861),C=r(6814),T=r(1447),x=r(2296),P=r(5986),a=r(5940),D=r(8991),S=r(2982),w=r(8645),y=r(9773),h=r(4354),v=r(6799),e=r(8533),u=r(3372),t=r(5879),s=r(9162),m=r(6036),E=r(3403),I=r(9236),b=r(8340),U=r(3814);const j=["maskResult"],V=["toSend"],B=["cardIdFace"];function K(f,k){if(1&f){const n=t.EpF();t.TgZ(0,"webcam",17),t.NdJ("imageCapture",function(o){t.CHM(n);const p=t.oxw(2);return t.KtG(p.proccessImage(o))})("initError",function(o){t.CHM(n);const p=t.oxw(2);return t.KtG(p.cameraError(o))}),t.qZA()}if(2&f){const n=t.oxw(2);t.Q6J("height",n.camera.dimensions.video.max.height)("width",n.camera.dimensions.video.max.width)("videoOptions",n.camera.configuration)("imageQuality",1)("captureImageData",!0)("allowCameraSwitch",!1)("trigger",n.takePicture$)("mirrorImage",n.demoData.isMobile?"never":"always")}}function H(f,k){if(1&f&&(t.TgZ(0,"div")(1,"div",18),t._uU(2),t.qZA(),t.TgZ(3,"div",19),t._uU(4),t.qZA()()),2&f){const n=t.oxw(2);t.xp6(1),t.Udp("color",n.project.branding.titleColor),t.xp6(1),t.Oqu(n.errorFace.title),t.xp6(1),t.Udp("color",n.project.branding.txtColor),t.xp6(1),t.Oqu(n.errorFace.subtitle)}}function Q(f,k){if(1&f){const n=t.EpF();t.TgZ(0,"div",3),t._UZ(1,"canvas",4,5),t.TgZ(3,"div",6),t.YNc(4,K,1,8,"webcam",7),t._UZ(5,"canvas",8,9)(7,"canvas",null,10),t.qZA(),t.TgZ(9,"div",11),t.YNc(10,H,5,6,"div",12),t.qZA(),t.TgZ(11,"div",13)(12,"button",14),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.takePictureSnapshot())}),t._uU(13),t.ALo(14,"transloco"),t.qZA(),t.TgZ(15,"button",15),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.ngOnInit())}),t._uU(16),t.ALo(17,"transloco"),t.qZA(),t.TgZ(18,"button",16),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.continue())}),t._uU(19),t.ALo(20,"transloco"),t.qZA()()()}if(2&f){const n=t.oxw();t.xp6(3),t.Udp("width",n.camera.dimensions.video.width,"px")("height",n.camera.dimensions.video.height,"px"),t.xp6(1),t.Q6J("ngIf",!n.response.base64Image),t.xp6(1),t.Udp("width",n.response.base64Image?n.camera.dimensions.result.width:n.camera.dimensions.video.width,"px")("height",n.response.base64Image?n.camera.dimensions.result.height:n.camera.dimensions.video.height,"px"),t.xp6(2),t.ekj("hidden",!0),t.xp6(3),t.Q6J("ngIf",n.errorFace&&!n.loadingResults),t.xp6(2),t.Udp("background",n.project.branding.buttonColor)("color",n.project.branding.buttonTxtColor),t.ekj("hidden",n.response.base64Image),t.Q6J("disabled",n.errorFace),t.xp6(1),t.hij(" ",t.lcZ(14,32,"id_scanning.manual_capture_button")," "),t.xp6(2),t.Udp("background",n.project.branding.buttonColor)("color",n.project.branding.buttonTxtColor),t.ekj("hidden",!n.response.base64Image),t.xp6(1),t.hij(" ",t.lcZ(17,34,"id_scanning.retry")," "),t.xp6(2),t.Udp("color",n.project.branding.txtColor),t.ekj("hidden",!n.response.base64Image),t.xp6(1),t.hij(" ",t.lcZ(20,36,"continue")," ")}}function Y(f,k){if(1&f&&(t.TgZ(0,"div",20),t._UZ(1,"img",21),t.TgZ(2,"h1",22),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t.TgZ(5,"p",22),t._uU(6),t.ALo(7,"transloco"),t.qZA()()),2&f){const n=t.oxw();t.xp6(2),t.Udp("color",n.project.branding.titleColor),t.xp6(1),t.Oqu(t.lcZ(4,6,"id_scanning.camera_not_found")),t.xp6(2),t.Udp("color",n.project.branding.txtColor),t.xp6(1),t.hij(" ",t.lcZ(7,8,"id_scanning.camera_not_found_description")," ")}}function J(f,k){if(1&f&&t._UZ(0,"kyc-document-errors-display",23),2&f){const n=t.oxw();t.Q6J("errorContent",n.errorContent)("attempts",n.attempts)("attemptsLimit",n.attemptsLimit)("callback",n.onErrorCallback)}}function N(f,k){if(1&f&&(t.TgZ(0,"p",22),t._uU(1),t.ALo(2,"transloco"),t.qZA()),2&f){const n=t.oxw(2);t.Udp("color",n.project.branding.txtColor),t.xp6(1),t.AsE(" ",t.lcZ(2,4,"id_scanning.remaining_attempts")," ",n.attempts.limit-n.attempts.current," ")}}function G(f,k){if(1&f){const n=t.EpF();t.TgZ(0,"div",20),t._UZ(1,"img",24),t.TgZ(2,"h1",22),t._uU(3),t.ALo(4,"transloco"),t.qZA(),t.TgZ(5,"p",22),t._uU(6),t.ALo(7,"transloco"),t.qZA(),t.YNc(8,N,3,6,"p",25),t.TgZ(9,"button",26),t.NdJ("click",function(){t.CHM(n);const o=t.oxw();return t.KtG(o.attempts.limit-o.attempts.current>0?o.tryAgain():o.restartDemo())}),t._uU(10),t.ALo(11,"transloco"),t.qZA()()}if(2&f){const n=t.oxw();t.xp6(1),t.Q6J("src",n.attempts.limit-n.attempts.current>0?"https://cdn.verifik.co/demo/failedtodetectdocument@3x.png":"https://cdn.verifik.co/demo/redstop.svg",t.LSH),t.xp6(1),t.Udp("color",n.project.branding.titleColor),t.xp6(1),t.hij(" ",t.lcZ(4,13,n.attempts.limit-n.attempts.current>0?"id_scanning.document_not_detected":"id_scanning.failed_to_detect_limit")," "),t.xp6(2),t.Udp("color",n.project.branding.txtColor),t.xp6(1),t.hij(" ",t.lcZ(7,15,n.attempts.limit-n.attempts.current>0?"id_scanning.document_not_detected_description":"id_scanning.failed_to_detect_limit_description")," "),t.xp6(2),t.Q6J("ngIf",n.attempts.limit-n.attempts.current>0),t.xp6(1),t.Udp("background",n.project.branding.buttonColor)("color",n.project.branding.buttonTxtColor),t.xp6(1),t.hij(" ",t.lcZ(11,17,n.failedToDetectDocument?"id_scanning.retry":"restart")," ")}}let z=(()=>{class f{get takePicture$(){return this.takePicture.asObservable()}constructor(n,c,o,p,i,g,l,_,O){this._dom=n,this._demoService=c,this._splashScreenService=o,this._translocoService=p,this.renderer=i,this._router=g,this._changeDetectorRef=l,this._fuseMediaWatcherService=_,this._KYCService=O,this.aspectRatio=85.6/53.98,this.takePicture=new w.x,this._unsubscribeAll=new w.x,this.setDefaultCamera=()=>{this.camera={hasPermissions:!1,isLoading:!1,configuration:{frameRate:{ideal:30,max:30},[this.demoData.isMobile?"width":"height"]:{ideal:1080},facingMode:h.w[this.demoData.isMobile]},dimensions:{video:{max:{height:Math.ceil(.7*window.innerHeight),width:Math.ceil(.9*window.innerWidth)}}}}},this.setDefaultInterval=()=>{this.interval={}},this.setDefaultResponse=()=>{this.response={isLoading:!1,isFailed:!1}},this.setVideoNgxCameraData=()=>{const M=this._dom.nativeElement.querySelector("video");M&&(M.addEventListener("loadeddata",()=>{this.setVideoDimensions(M),this.drawRect()}),this.interval.detectFace||(this.interval.detectFace=setInterval(()=>{this.response.base64Image&&(this.interval.detectFace=clearInterval(this.interval.detectFace)),this.takePicture.next()},this.demoData.time)),this.interval.checkNgxVideo=clearInterval(this.interval.checkNgxVideo),this.setVideoDimensions(M),this.drawRect(),this.loading({isLoading:!1,start:!0}))},this.loading=({isLoading:M=!0,start:W,result:L})=>{const R=W?"camera":L&&"response";R&&(this[R].isLoading=M);const Z=M?"show":"hide";this.demoData.loading=M,this._splashScreenService[Z]()},this.setImageOnCanvas=(M,W,L,R)=>{M.width=R.width,M.height=R.height,M.style.marginLeft=`${R.offsetX||0}px`,M.style.marginTop=`${R.offsetY||0}px`;const Z=M.getContext("2d");Z.clearRect(0,0,L.width,L.height),Z.drawImage(W,L.offsetX,L.offsetY,L.width,L.height,0,0,R.width,R.height)},this._ObserveDomMedia(),this.demoData=this._demoService.getDemoData(),this.view=this._router.url.includes("/kyc")?"kyc":"demo",this.project=new e.XR({}),this.projectFlow=new e.nd({}),"kyc"===this.view&&(this.appRegistration=this._KYCService.appRegistration,this.project=this._KYCService.currentProject,this.projectFlow=this._KYCService.currentProjectFlow,this.navigation=this._KYCService.getNavigation(),this.attempts=this.appRegistration?.failedDocumentValidations?.length||0,this.attemptsLimit=this.projectFlow.onboardingSettings.document.maxAttempts),this.errorContent={message:""},this.startDefaultValues(),this.setDefaultInterval(),this.renderer.listen("window","resize",()=>{this.interval.checkNgxVideo=setInterval(()=>{this.setVideoNgxCameraData()},this.demoData.time)}),this._changeDetectorRef.markForCheck()}_ObserveDomMedia(){this._fuseMediaWatcherService.onMediaChange$.pipe((0,y.R)(this._unsubscribeAll)).subscribe(({matchingAliases:n})=>{this.phoneMode=!n.includes("lg")&&!n.includes("md")&&!n.includes("sm"),this.tabletMode=!(n.includes("lg")||n.includes("md")||!n.includes("sm")),console.log(this.tabletMode,this.phoneMode),this._changeDetectorRef.markForCheck()})}ngOnInit(){var n=this;this.startDefaultValues(),this.camera.hasPermissions=!0,this.errorFace={},this.loading({start:!0}),this._demoService.faceapi$.subscribe(function(){var c=(0,d.Z)(function*(o){o&&(n.interval.checkNgxVideo=setInterval(()=>{n.setMaxVideoDimensions(),n.setVideoNgxCameraData()},n.demoData.time))});return function(o){return c.apply(this,arguments)}}())}startDefaultValues(){this.setDefaultResponse(),this.setDefaultCamera(),this.setMaxVideoDimensions(),this._changeDetectorRef.markForCheck()}setVideoDimensions(n){this.camera.dimensions.video.height=n.clientHeight,this.camera.dimensions.video.width=n.clientWidth;const c=this.maskResultCanvasRef.nativeElement;c.style.marginLeft="0px",c.style.marginTop="0px"}setMaxVideoDimensions(){this.camera.dimensions.video={max:{height:Math.ceil(.7*window.innerHeight),width:Math.ceil(.9*window.innerWidth)}},this.camera.dimensions.result=void 0}setResultDimensions(n,c,o){c<o?(n.offsetY=Math.floor(.1*c),n.height=Math.floor(.8*c),n.width=Math.floor(this.aspectRatio*n.height),n.offsetX=Math.floor((o-n.width)/2)):(n.offsetX=Math.floor(.1*o),n.width=Math.floor(.8*o),n.height=Math.floor(this.aspectRatio*n.width),n.offsetY=Math.floor((c-n.height)/2))}drawRect(){this.camera.dimensions.result={height:0,width:0,offsetX:0,offsetY:0},this.setResultDimensions(this.camera.dimensions.result,this.camera.dimensions.video.height,this.camera.dimensions.video.width);const n=this.maskResultCanvasRef.nativeElement,c=this.camera.dimensions.video,o=this.camera.dimensions.result;n.height=c.height,n.width=c.width;const p=n.getContext("2d");p.clearRect(0,0,c.width,c.height),p.fillStyle="rgba(255, 255, 255, 0.75)",p.fillRect(0,0,c.width,c.height),p.globalCompositeOperation="destination-out",p.fillStyle="rgba(0, 0, 0, 1)",p.fillRect(o.offsetX,o.offsetY,o.width,o.height),p.globalCompositeOperation="source-over"}cameraError(n){n.mediaStreamError&&"NotAllowedError"===n.mediaStreamError.name&&(this.loading({isLoading:!1,start:!0}),this.camera.hasPermissions=!1)}proccessImage(n){var c=this;if(this.response.base64Image)return;if(!this.interval.detectFace)return void this.takePictureManual(n);const o=new Image;o.src=n.imageAsDataUrl,o.onload=(0,d.Z)(function*(){try{c.detectFace(o)}catch(p){alert(p.message)}})}detectFace(n){var c=this;return(0,d.Z)(function*(){try{const o=yield v.Qr(n,new v.d7({minConfidence:.2})).withFaceLandmarks();return o.length?(c.checkFaceTimeout=clearTimeout(c.checkFaceTimeout),c.errorFace=null,o):(c.checkFaceTimeout||(c.checkFaceTimeout=setTimeout(()=>{c.errorFace={title:c._translocoService.translate("id_scanning.face_not_found"),subtitle:c._translocoService.translate("id_scanning.face_not_found_details")}},3*c.demoData.time)),null)}catch(o){alert(o.message)}})()}takePictureManual(n){var c=this;const o=new Image;o.src=n.imageAsDataUrl,o.onload=(0,d.Z)(function*(){const p=yield c.detectFace(o);if(!p||!p.length)return alert(c._translocoService.translate("id_scanning.face_not_found")),c.tryAgain();const i=c._demoService.getBiggestFace(p.map(_=>_.detection.box));c.idCard={face:c._demoService.cutFaceIdCard(o,i,c.cardIdFaceRef.nativeElement)},c.camera.dimensions.real={height:0,width:0,offsetX:0,offsetY:0},c.setResultDimensions(c.camera.dimensions.real,o.height,o.width),c.setImageOnCanvas(c.maskResultCanvasRef.nativeElement,o,c.camera.dimensions.real,c.camera.dimensions.result);const l=c.ToSendCanvasRef.nativeElement;c.setImageOnCanvas(l,o,c.camera.dimensions.real,c.camera.dimensions.real),c.response.base64Image=l.toDataURL("image/jpeg")})}takePictureSnapshot(){this.interval.detectFace=clearInterval(this.interval.detectFace),this.takePicture.next()}continue(){var n=this;return(0,d.Z)(function*(){const c={image:n.response.base64Image.replace("data:image/jpeg;base64",""),force:n.appRegistration?.forceUpload||!1};n.loading({result:!0}),"kyc"!==n.view?n._demoService.sendDocument(c).subscribe(o=>{n._demoService.setDemoDocument(o.data),localStorage.setItem("idCardFaceImage",n.idCard.face),localStorage.setItem("documentId",o.data._id),n.loading({isLoading:!1}),n._demoService.moveToStep(3)},o=>{n.response.isFailed=!0,n.loading({isLoading:!1})}):n._KYCService.createDocumentValidation({...c,documentFace:n.idCard.face}).subscribe({next:o=>{n.appRegistration.documentValidation=o.data.documentValidation,n._KYCService.navigateTo("next")},error:o=>{n.errorResult=!0,n.errorContent=o.error,n.loading({isLoading:!1}),n._splashScreenService.hide()},complete:()=>{n.loading({isLoading:!1})}})})()}tryAgain(){this.attempts++,this.ngOnInit()}restartDemo(){this._demoService.restart()}onErrorCallback(n){window.location.reload()}static#t=this.\u0275fac=function(c){return new(c||f)(t.Y36(t.SBq),t.Y36(s.e),t.Y36(m.j),t.Y36(D.Vn),t.Y36(t.Qsj),t.Y36(E.F0),t.Y36(t.sBO),t.Y36(I.T),t.Y36(b.H))};static#e=this.\u0275cmp=t.Xpm({type:f,selectors:[["id-scanning-ios"]],viewQuery:function(c,o){if(1&c&&(t.Gf(j,5),t.Gf(V,5),t.Gf(B,5)),2&c){let p;t.iGM(p=t.CRH())&&(o.maskResultCanvasRef=p.first),t.iGM(p=t.CRH())&&(o.ToSendCanvasRef=p.first),t.iGM(p=t.CRH())&&(o.cardIdFaceRef=p.first)}},standalone:!0,features:[t.jDz],decls:5,vars:4,consts:[["fxLayout","column","fxLayoutAlign","start center","class","bg-white rounded-lg shadow-lg w-full",4,"ngIf"],["fxLayout","column","fxLayoutAlign","center center","class","id-scanning-error-div",4,"ngIf"],["class","m-16",3,"errorContent","attempts","attemptsLimit","callback",4,"ngIf"],["fxLayout","column","fxLayoutAlign","start center",1,"bg-white","rounded-lg","shadow-lg","w-full"],["hidden","true"],["cardIdFace",""],[1,"relative"],[3,"height","width","videoOptions","imageQuality","captureImageData","allowCameraSwitch","trigger","mirrorImage","imageCapture","initError",4,"ngIf"],[1,"absolute","top-0","left-0"],["maskResult",""],["toSend",""],["fxLayout","column","fxLayoutAlign","center center",1,"text-center","h-20","pb-4","sm:h-8","xs:h-8","my-2"],[4,"ngIf"],["fxLayout","row","fxLayoutAlign","end center"],["mat-raised-button","",1,"m-4","z-index-2",3,"disabled","click"],["mat-stroked-button","",1,"m-4","z-index-2",3,"click"],["mat-raised-button","",1,"mx-2",3,"click"],[3,"height","width","videoOptions","imageQuality","captureImageData","allowCameraSwitch","trigger","mirrorImage","imageCapture","initError"],[1,"text-3xl","font-bold"],[1,"text-gray-600"],["fxLayout","column","fxLayoutAlign","center center",1,"id-scanning-error-div"],["src","https://cdn.verifik.co/demo/nocameraenabled.svg","alt","",1,"id-scanning-no-camera-enabled-img"],[1,"mt-4"],[1,"m-16",3,"errorContent","attempts","attemptsLimit","callback"],["alt","",1,"id-scanning-failed-document-img",3,"src"],["class","mt-4",3,"color",4,"ngIf"],["mat-raised-button","",1,"mt-4","z-index-2","id-scanning-try-again-button",3,"click"]],template:function(c,o){1&c&&(t.ynx(0),t.YNc(1,Q,21,38,"div",0),t.BQk(),t.YNc(2,Y,8,10,"div",1),t.YNc(3,J,1,4,"kyc-document-errors-display",2),t.YNc(4,G,12,19,"div",1)),2&c&&(t.xp6(1),t.Q6J("ngIf",!o.response.isFailed&&o.camera.hasPermissions&&!o.errorResult),t.xp6(1),t.Q6J("ngIf",!o.response.isFailed&&!o.camera.hasPermissions&&!o.camera.isLoading),t.xp6(1),t.Q6J("ngIf",o.errorContent.message),t.xp6(1),t.Q6J("ngIf",o.response.isFailed))},dependencies:[T.o9,U.xw,U.Wh,P.p9,x.ot,x.lW,C.ez,C.O5,a.Cq,D.y4,D.Ot,S.Tm,S.i3,u.M],styles:[".id-scanning-error-div[_ngcontent-%COMP%]{margin-top:20px;width:600px;background:white;height:600px;padding:16px;box-shadow:3px 3px 3px 3px #0000000d}.id-scanning-error-div[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#0036e7;font-size:24px;font-weight:800;text-align:center}.id-scanning-error-div[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#01236da6;font-size:16px;font-weight:300;text-align:center}.id-scanning-no-camera-enabled-img[_ngcontent-%COMP%], .id-scanning-failed-document-img[_ngcontent-%COMP%]{width:40%}",".demo-header[_ngcontent-%COMP%]{background-color:#01236d;width:100%;height:64px;color:#fff!important}.demo-header-logo[_ngcontent-%COMP%]{width:120px;padding-left:16px;height:auto}.demo-header-action[_ngcontent-%COMP%]{padding-right:25px}.demo-header-partner-icon[_ngcontent-%COMP%]{width:40px;padding-right:10px}.demo-content[_ngcontent-%COMP%]{width:100%;height:auto}.step-one-circle[_ngcontent-%COMP%]{background:#0036e7;z-index:2;color:#fff;width:45px;height:45px;padding-top:11px;text-align:center;border-radius:50%;margin-right:25px}.disabled-background[_ngcontent-%COMP%]{background:rgba(0,54,231,.2509803922)!important}.font-bold[_ngcontent-%COMP%]{font-weight:800}.box-shadow-3px[_ngcontent-%COMP%]{box-shadow:3px 3px 3px 3px #0000000d}.grey-background[_ngcontent-%COMP%]{background-color:#80808021}.m-2[_ngcontent-%COMP%]{margin:2px}.m-4[_ngcontent-%COMP%]{margin:4px}.m-8[_ngcontent-%COMP%]{margin:8px}.mt-4[_ngcontent-%COMP%]{margin-top:4px}.mt-8[_ngcontent-%COMP%]{margin-top:8px}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer!important;font-weight:800}.w-50p[_ngcontent-%COMP%]{width:50%}.text-center[_ngcontent-%COMP%]{text-align:center}.margin-left-16[_ngcontent-%COMP%]{margin-left:25px}h1[_ngcontent-%COMP%]{font-size:35px;padding-top:32px;font-weight:700;color:#0036e7}h2[_ngcontent-%COMP%]{font-size:30px;padding-top:16px;font-weight:700;color:#0036e7}@media (max-width: 599px){.demo-header-logo[_ngcontent-%COMP%]{width:120px}}"]})}return f})()},692:(F,A,r)=>{r.d(A,{s:()=>c});var d=r(5861),C=r(6814),T=r(1447),x=r(2296),P=r(5986),a=r(5940),D=r(8991),S=r(6799),w=r(8533),y=r(3372),h=r(8645),v=r(9773),e=r(5879),u=r(9162),t=r(3403),s=r(6036),m=r(9236),E=r(8340),I=r(3814),b=r(7509);const U=["videoElement"],j=["canvas"],V=["result"],B=["toSend"],K=["cardIdFace"];function H(o,p){if(1&o&&(e.TgZ(0,"div")(1,"div",11),e._uU(2),e.qZA(),e.TgZ(3,"div",12),e._uU(4),e.qZA()()),2&o){const i=e.oxw(3);e.xp6(1),e.Udp("color",i.project?i.project.branding.titleColor:null),e.xp6(1),e.Oqu(i.errorFace.title),e.xp6(1),e.Udp("color",i.project?i.project.branding.txtColor:null),e.xp6(1),e.Oqu(i.errorFace.subtitle)}}const Q=function(o){return{"mobile-height":o}},Y=function(o){return{"max-h-[75vh]":o}};function J(o,p){if(1&o){const i=e.EpF();e.TgZ(0,"div",13)(1,"div",14),e._UZ(2,"video",15,16)(4,"canvas",17,18)(6,"canvas",17,19)(8,"canvas",17,20),e.qZA(),e.TgZ(10,"div",21)(11,"button",22),e.NdJ("click",function(){e.CHM(i);const l=e.oxw(3);return e.KtG(l.takePicture())}),e._uU(12),e.ALo(13,"transloco"),e.qZA(),e.TgZ(14,"button",23),e.NdJ("click",function(){e.CHM(i);const l=e.oxw(3);return e.KtG(l.tryAgain())}),e._uU(15),e.ALo(16,"transloco"),e.qZA(),e.TgZ(17,"button",24),e.NdJ("click",function(){e.CHM(i);const l=e.oxw(3);return e.KtG(l.continue())}),e._uU(18),e.ALo(19,"transloco"),e.qZA()()()}if(2&o){const i=e.oxw(3);e.Q6J("ngClass",e.VKq(46,Q,i.phoneMode)),e.xp6(1),e.Udp("width",i.WIDTH,"px")("height",i.HEIGHT,"px"),e.xp6(1),e.ekj("hidden",i.base64Images),e.Q6J("ngClass",e.VKq(48,Y,!i.phoneMode)),e.xp6(2),e.Udp("width",i.WIDTH,"px")("height",i.HEIGHT,"px"),e.ekj("hidden",i.base64Images),e.xp6(2),e.ekj("hidden",!i.base64Images),e.xp6(2),e.ekj("hidden",!0),e.xp6(3),e.Udp("background",i.project.branding.buttonColor)("color",i.project.branding.buttonTxtColor),e.ekj("hidden",i.base64Images),e.Q6J("disabled",i.errorFace),e.xp6(1),e.hij(" ",e.lcZ(13,40,"id_scanning.manual_capture_button")," "),e.xp6(2),e.Udp("background",i.project.branding.buttonColor)("color",i.project.branding.buttonTxtColor),e.ekj("hidden",!i.base64Images),e.xp6(1),e.hij(" ",e.lcZ(16,42,"id_scanning.retry")," "),e.xp6(2),e.Udp("background",i.project.branding.buttonColor)("color",i.project.branding.buttonTxtColor),e.ekj("hidden",!i.base64Images),e.xp6(1),e.hij(" ",e.lcZ(19,44,"continue")," ")}}function N(o,p){if(1&o&&(e.TgZ(0,"div",7)(1,"div",8),e.YNc(2,H,5,6,"div",9),e.qZA(),e.YNc(3,J,20,50,"div",10),e.qZA()),2&o){const i=e.oxw(2);e.xp6(2),e.Q6J("ngIf",i.errorFace&&!i.loadingResults),e.xp6(1),e.Q6J("ngIf",!i.failedToDetectDocument)}}function G(o,p){if(1&o&&(e.TgZ(0,"div",3),e._UZ(1,"canvas",4,5),e.YNc(3,N,4,2,"div",6),e.qZA()),2&o){const i=e.oxw();e.xp6(3),e.Q6J("ngIf",!i.loadingCamera&&i.hasCameraPermissions)}}function z(o,p){if(1&o&&(e.TgZ(0,"div",25),e._UZ(1,"img",26),e.TgZ(2,"h1",27),e._uU(3),e.ALo(4,"transloco"),e.qZA(),e.TgZ(5,"p",27),e._uU(6),e.ALo(7,"transloco"),e.qZA()()),2&o){const i=e.oxw();e.xp6(2),e.Udp("color",i.project.branding.titleColor),e.xp6(1),e.Oqu(e.lcZ(4,6,"id_scanning.camera_not_found")),e.xp6(2),e.Udp("color",i.project.branding.txtColor),e.xp6(1),e.hij(" ",e.lcZ(7,8,"id_scanning.camera_not_found_description")," ")}}function f(o,p){if(1&o&&e._UZ(0,"kyc-document-errors-display",28),2&o){const i=e.oxw();e.Q6J("errorContent",i.errorContent)("attempts",i.attempts)("attemptsLimit",i.attemptsLimit)("callback",i.onErrorCallback)}}function k(o,p){if(1&o&&(e.TgZ(0,"p",27),e._uU(1),e.ALo(2,"transloco"),e.qZA()),2&o){const i=e.oxw(2);e.Udp("color",i.project.branding.txtColor),e.xp6(1),e.AsE(" ",e.lcZ(2,4,"id_scanning.remaining_attempts")," ",i.attemptsLimit-i.attempts," ")}}function n(o,p){if(1&o){const i=e.EpF();e.TgZ(0,"div",25),e._UZ(1,"img",29),e.TgZ(2,"h1",27),e._uU(3),e.ALo(4,"transloco"),e.qZA(),e.TgZ(5,"p",27),e._uU(6),e.ALo(7,"transloco"),e.qZA(),e.YNc(8,k,3,6,"p",30),e.TgZ(9,"button",31),e.NdJ("click",function(){e.CHM(i);const l=e.oxw();return e.KtG(l.attemptsLimit-l.attempts>0?l.tryAgain(!0):l.restartDemo())}),e._uU(10),e.ALo(11,"transloco"),e.qZA()()}if(2&o){const i=e.oxw();e.xp6(1),e.Q6J("src",i.attemptsLimit-i.attempts>0?"https://cdn.verifik.co/demo/failedtodetectdocument@3x.png":"https://cdn.verifik.co/demo/redstop.svg",e.LSH),e.xp6(1),e.Udp("color",i.project.branding.titleColor),e.xp6(1),e.hij(" ",e.lcZ(4,13,i.attemptsLimit-i.attempts>0?"id_scanning.document_not_detected":"id_scanning.failed_to_detect_limit")," "),e.xp6(2),e.Udp("color",i.project.branding.txtColor),e.xp6(1),e.hij(" ",e.lcZ(7,15,i.attemptsLimit-i.attempts>0?"id_scanning.document_not_detected_description":"id_scanning.failed_to_detect_limit_description")," "),e.xp6(2),e.Q6J("ngIf",i.attemptsLimit-i.attempts>0),e.xp6(1),e.Udp("color",i.project.branding.buttonTxtColor)("background",i.project.branding.buttonColor),e.xp6(1),e.hij(" ",e.lcZ(11,17,i.failedToDetectDocument?"id_scanning.retry":"restart")," ")}}let c=(()=>{class o{constructor(i,g,l,_,O,M,W,L){this._demoService=i,this._router=g,this._splashScreenService=l,this._changeDetectorRef=_,this._translocoService=O,this._fuseMediaWatcherService=M,this.renderer=W,this._KYCService=L,this.aspectRatio=85.6/53.98,this.videoOptions={frameRate:{ideal:30,max:30}},this._unsubscribeAll=new h.x,this.setCanvasDimensions=()=>{this.HEIGHT=this.videoElement.nativeElement.clientHeight,this.WIDTH=this.videoElement.nativeElement.clientWidth;const Z=this.canvasRef.nativeElement;Z.height=this.HEIGHT,Z.width=this.WIDTH,this.drawRect(Z.getContext("2d"))},this._ObserveDomMedia(),this.attemptsLimit=3,this.loadingCamera=!1,this.loading=!1,this.hasCameraPermissions=!1,this.failedToDetectDocument=!1,this.base64Images=void 0,this.errorFace={},this.demoData=this._demoService.getDemoData(),this.view=this._router.url.includes("/kyc")?"kyc":"demo",this.project=new w.XR({}),this.projectFlow=new w.nd({}),"kyc"===this.view&&(this.appRegistration=this._KYCService.appRegistration,this.project=this._KYCService.currentProject,this.projectFlow=this._KYCService.currentProjectFlow,this.navigation=this._KYCService.getNavigation(),this.attempts=this.appRegistration?.failedDocumentValidations?.length||0,this.attemptsLimit=this.projectFlow.onboardingSettings.document.maxAttempts),this.errorContent={message:""},this.videoOptions[this.demoData.isMobile?"width":"height"]={ideal:1080},this.videoOptions.facingMode=this.demoData.isMobile?"environment":"user",this.video={},this.rectCredential={},this.renderer.listen("window","resize",()=>{this.videoElement&&this.setCanvasDimensions()})}ngOnInit(){this._ObserveDomMedia(),this._demoService.faceapi$.subscribe(i=>{i&&this.startCamera()})}_ObserveDomMedia(){this._fuseMediaWatcherService.onMediaChange$.pipe((0,v.R)(this._unsubscribeAll)).subscribe(({matchingAliases:i})=>{this.phoneMode=!i.includes("lg")&&!i.includes("md")&&!i.includes("sm"),this.tabletMode=!(i.includes("lg")||i.includes("md")||!i.includes("sm")),this._changeDetectorRef.markForCheck()})}detectFace(i){var g=this;return(0,d.Z)(function*(){try{const l=yield S.Qr(i,new S.d7({minConfidence:.2})).withFaceLandmarks();return l.length?(g.checkFaceTimeout=clearTimeout(g.checkFaceTimeout),g.errorFace=null,l):(g.checkFaceTimeout||(g.checkFaceTimeout=setTimeout(()=>{g.errorFace={title:g._translocoService.translate("id_scanning.face_not_found"),subtitle:g._translocoService.translate("id_scanning.face_not_found_details")}},3*g.demoData.time)),null)}catch(l){alert(l.message)}})()}startCamera(){navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(this.loadingCamera=!0,this._splashScreenService.show(),navigator.mediaDevices.getUserMedia({video:this.videoOptions,audio:!1}).then(i=>{this.stream=i,this.hasCameraPermissions=!0,this.loadingCamera=!1;const l=this.stream.getVideoTracks()[0].getSettings(),{width:_,height:O}=l;this.video.height=O,this.video.width=_,setTimeout(()=>{this.videoElement.nativeElement.srcObject=i,this.videoElement.nativeElement.addEventListener("loadedmetadata",()=>{this.demoData.isMobile||(this.videoElement.nativeElement.style.transform="scaleX(-1)"),this.setCanvasDimensions(),this.detectFaceInterval=setInterval(()=>this.detectFace(this.videoElement.nativeElement),this.demoData.time),this.demoData.loading=!1,this._splashScreenService.hide()})},300)}).catch(i=>{console.error("Error accessing the camera:",i),this.loadingCamera=!1,this.hasCameraPermissions=!1,this.demoData.loading=!1,this._splashScreenService.hide()})):(console.error("Browser does not support getUserMedia API."),this.hasCameraPermissions=!1)}tryAgain(i=!1){i&&this.attempts++,this.base64Images=void 0,this.failedToDetectDocument=!1,this.errorFace={},this.errorContent.message=null,this.errorResult=!1,this.startCamera()}restartDemo(){"kyc"===this.view&&(this.appRegistration.documentValidation=null),this._demoService.restart()}continue(){var i=this;return(0,d.Z)(function*(){if(i.loading)return;i.loading=!0,i.idToSend={image:i.base64Images,force:i.appRegistration?.forceUpload||!1};const g=yield i.detectFace(i.canvasToSendRef.nativeElement);if(console.log({faces:g}),!g.length)return i.errorResult=!0,i.errorContent={message:"face_not_found"},i.tryAgain();const l=i._demoService.getBiggestFace(g.map(O=>O.detection.box)),_=i._demoService.cutFaceIdCard(i.canvasToSendRef.nativeElement,l,i.cardIdFaceRef.nativeElement);i.demoData.loading=!0,i._splashScreenService.show(),"kyc"!==i.view?i._demoService.sendDocument({image:i.idToSend.image}).subscribe(O=>{i._demoService.setDemoDocument(O.data),localStorage.setItem("documentId",O.data._id),localStorage.setItem("idCardFaceImage",_),i.demoData.loading=!1,i._splashScreenService.hide(),i._demoService.moveToStep(3)},O=>{i.failedToDetectDocument=!0,i.demoData.loading=!1,i._splashScreenService.hide()}):i._KYCService.createDocumentValidation({...i.idToSend,documentFace:_}).subscribe({next:O=>{i.appRegistration.documentValidation=O.data.documentValidation,i._KYCService.navigateTo("next")},error:O=>{i.errorResult=!0,i.errorContent=O.error,i._splashScreenService.hide()},complete:()=>{i.demoData.loading=!1,i._splashScreenService.hide()}})})()}drawRect(i){i.clearRect(0,0,this.WIDTH,this.HEIGHT),i.fillStyle="rgba(255, 255, 255, 0.75)",i.fillRect(0,0,this.WIDTH,this.HEIGHT),i.globalCompositeOperation="destination-out";const g=this.video.height<this.video.width;this.setDimensions(g,this.HEIGHT,this.WIDTH,this.rectCredential),this.setDimensions(g,this.video.height,this.video.width,this.video),i.fillStyle="rgba(0, 0, 0, 1)",i.fillRect(this.rectCredential.x,this.rectCredential.y,this.rectCredential.rectWidth,this.rectCredential.rectHeight),i.globalCompositeOperation="source-over"}setDimensions(i,g,l,_){i?(_.y=Math.floor(.1*g),_.rectHeight=Math.floor(.8*g),_.rectWidth=Math.floor(this.aspectRatio*_.rectHeight),_.x=Math.floor((l-_.rectWidth)/2)):(_.x=Math.floor(.1*l),_.rectWidth=Math.floor(.8*l),_.rectHeight=Math.floor(this.aspectRatio*_.rectWidth),_.y=Math.floor((g-_.rectHeight)/2))}stopRecord(){this.stream&&this.stream.getTracks().forEach(i=>i.stop())}takePicture(){var i=this;return(0,d.Z)(function*(){i.detectFaceInterval=clearInterval(i.detectFaceInterval);const g=i.canvasToSendRef.nativeElement;i.setPictureInCavas(i.canvasResultRef.nativeElement,i.rectCredential,i.video),i.setPictureInCavas(g,i.video);const _=g.toDataURL("image/jpeg").replace(/^data:.*;base64,/,"");i.base64Images=_,i._changeDetectorRef.markForCheck(),i.stopRecord()})()}setPictureInCavas(i,g,l){const _=i.getContext("2d");i.width=g.rectWidth,i.height=g.rectHeight,i.style.marginLeft=`${g.x}px`,i.style.marginTop=`${g.y}px`,l||(l={x:g.x,y:g.y,rectWidth:g.rectWidth,rectHeight:g.rectHeight}),_.drawImage(this.videoElement.nativeElement,l.x,l.y,l.rectWidth,l.rectHeight,0,0,g.rectWidth,g.rectHeight)}onErrorCallback(i){window.location.reload()}static#t=this.\u0275fac=function(g){return new(g||o)(e.Y36(u.e),e.Y36(t.F0),e.Y36(s.j),e.Y36(e.sBO),e.Y36(D.Vn),e.Y36(m.T),e.Y36(e.Qsj),e.Y36(E.H))};static#e=this.\u0275cmp=e.Xpm({type:o,selectors:[["id-scanning"]],viewQuery:function(g,l){if(1&g&&(e.Gf(U,5),e.Gf(j,5),e.Gf(V,5),e.Gf(B,5),e.Gf(K,5)),2&g){let _;e.iGM(_=e.CRH())&&(l.videoElement=_.first),e.iGM(_=e.CRH())&&(l.canvasRef=_.first),e.iGM(_=e.CRH())&&(l.canvasResultRef=_.first),e.iGM(_=e.CRH())&&(l.canvasToSendRef=_.first),e.iGM(_=e.CRH())&&(l.cardIdFaceRef=_.first)}},standalone:!0,features:[e.jDz],decls:4,vars:4,consts:[["fxLayout","column","fxLayoutAlign","center center","class","bg-white rounded-lg shadow-lg items-center w-full",4,"ngIf"],["fxLayout","column","fxLayoutAlign","center center","class","id-scanning-error-div",4,"ngIf"],["class","mt-16 w-1/2",3,"errorContent","attempts","attemptsLimit","callback",4,"ngIf"],["fxLayout","column","fxLayoutAlign","center center",1,"bg-white","rounded-lg","shadow-lg","items-center","w-full"],["hidden","true"],["cardIdFace",""],["class","w-full height-full",4,"ngIf"],[1,"w-full","height-full"],["fxLayout","column","fxLayoutAlign","center center",1,"text-center","h-20","pb-4","sm:h-8","xs:h-8","my-2"],[4,"ngIf"],["fxLayout","column","fxLayoutAlign","center center","class","w-full h-full",3,"ngClass",4,"ngIf"],[1,"text-3xl","font-bold"],[1,"text-gray-600"],["fxLayout","column","fxLayoutAlign","center center",1,"w-full","h-full",3,"ngClass"],[1,"relative","w-full"],["autoplay","",1,"absolute","top-0","left-0","w-full",3,"ngClass"],["videoElement",""],[1,"absolute","top-0","left-0"],["canvas",""],["result",""],["toSend",""],["fxLayout","row","fxLayoutAlign","center center",1,"relative","-top-18"],["mat-raised-button","",1,"m-4","z-index-2",3,"disabled","click"],["mat-stroked-button","",1,"m-4","z-index-2",3,"click"],["mat-raised-button","",1,"mx-2",3,"click"],["fxLayout","column","fxLayoutAlign","center center",1,"id-scanning-error-div"],["src","https://cdn.verifik.co/demo/nocameraenabled.svg","alt","",1,"id-scanning-no-camera-enabled-img"],[1,"mt-4"],[1,"mt-16","w-1/2",3,"errorContent","attempts","attemptsLimit","callback"],["alt","",1,"id-scanning-failed-document-img",3,"src"],["class","mt-4",3,"color",4,"ngIf"],["mat-raised-button","","color","primary",1,"mt-4","z-index-2","id-scanning-try-again-button",3,"click"]],template:function(g,l){1&g&&(e.YNc(0,G,4,1,"div",0),e.YNc(1,z,8,10,"div",1),e.YNc(2,f,1,4,"kyc-document-errors-display",2),e.YNc(3,n,12,19,"div",1)),2&g&&(e.Q6J("ngIf",!l.failedToDetectDocument&&l.hasCameraPermissions&&!l.loadingCamera&&!l.errorResult),e.xp6(1),e.Q6J("ngIf",!l.failedToDetectDocument&&!l.hasCameraPermissions&&!l.loadingCamera),e.xp6(1),e.Q6J("ngIf",l.errorContent.message),e.xp6(1),e.Q6J("ngIf",l.failedToDetectDocument))},dependencies:[T.o9,I.xw,I.Wh,b.oO,P.p9,x.ot,x.lW,C.ez,C.mk,C.O5,a.Cq,D.y4,D.Ot,y.M],styles:[".id-scanning-error-div[_ngcontent-%COMP%]{margin-top:20px;width:600px;background:white;height:600px;padding:16px;box-shadow:3px 3px 3px 3px #0000000d}.id-scanning-error-div[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#0036e7;font-size:24px;font-weight:800;text-align:center}.id-scanning-error-div[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#01236da6;font-size:16px;font-weight:300;text-align:center}.mobile-height[_ngcontent-%COMP%]{height:calc(100vh - 190px)}.id-scanning-no-camera-enabled-img[_ngcontent-%COMP%]{width:40%}.height-full[_ngcontent-%COMP%]{height:calc(100vh - 189px)}.height-full-canvas[_ngcontent-%COMP%]{height:calc(100vh - 269px)}.height-full-button[_ngcontent-%COMP%]{height:calc(100vh - 480px)}.id-scanning-failed-document-img[_ngcontent-%COMP%]{width:40%}",".demo-header[_ngcontent-%COMP%]{background-color:#01236d;width:100%;height:64px;color:#fff!important}.demo-header-logo[_ngcontent-%COMP%]{width:120px;padding-left:16px;height:auto}.demo-header-action[_ngcontent-%COMP%]{padding-right:25px}.demo-header-partner-icon[_ngcontent-%COMP%]{width:40px;padding-right:10px}.demo-content[_ngcontent-%COMP%]{width:100%;height:auto}.step-one-circle[_ngcontent-%COMP%]{background:#0036e7;z-index:2;color:#fff;width:45px;height:45px;padding-top:11px;text-align:center;border-radius:50%;margin-right:25px}.disabled-background[_ngcontent-%COMP%]{background:rgba(0,54,231,.2509803922)!important}.font-bold[_ngcontent-%COMP%]{font-weight:800}.box-shadow-3px[_ngcontent-%COMP%]{box-shadow:3px 3px 3px 3px #0000000d}.grey-background[_ngcontent-%COMP%]{background-color:#80808021}.m-2[_ngcontent-%COMP%]{margin:2px}.m-4[_ngcontent-%COMP%]{margin:4px}.m-8[_ngcontent-%COMP%]{margin:8px}.mt-4[_ngcontent-%COMP%]{margin-top:4px}.mt-8[_ngcontent-%COMP%]{margin-top:8px}.cursor-pointer[_ngcontent-%COMP%]{cursor:pointer!important;font-weight:800}.w-50p[_ngcontent-%COMP%]{width:50%}.text-center[_ngcontent-%COMP%]{text-align:center}.margin-left-16[_ngcontent-%COMP%]{margin-left:25px}h1[_ngcontent-%COMP%]{font-size:35px;padding-top:32px;font-weight:700;color:#0036e7}h2[_ngcontent-%COMP%]{font-size:30px;padding-top:16px;font-weight:700;color:#0036e7}@media (max-width: 599px){.demo-header-logo[_ngcontent-%COMP%]{width:120px}}"]})}return o})()},4354:(F,A,r)=>{r.d(A,{w:()=>d});var d=function(C){return C.ENVIRONMENT="environment",C.USER="user",C.true="environment",C.false="user",C}(d||{})},3372:(F,A,r)=>{r.d(A,{M:()=>t});var d=r(6814),C=r(1447),T=r(2296),x=r(617),P=r(8991),a=r(5879),D=r(3814);function S(s,m){1&s&&(a.TgZ(0,"div",6),a._UZ(1,"img",7),a.TgZ(2,"h1",8),a._uU(3),a.ALo(4,"transloco"),a.qZA()()),2&s&&(a.xp6(1),a.Q6J("src","https://cdn.verifik.co/demo/failedtodetectdocument@3x.png",a.LSH),a.xp6(2),a.hij(" ",a.lcZ(4,2,"id_scanning.country_not_allowed")," "))}function w(s,m){1&s&&(a.TgZ(0,"div",6),a._UZ(1,"img",7),a.TgZ(2,"h1",8),a._uU(3),a.ALo(4,"transloco"),a.qZA()()),2&s&&(a.xp6(1),a.Q6J("src","https://cdn.verifik.co/assets/biometric-services/driverLicense.svg",a.LSH),a.xp6(2),a.hij(" ",a.lcZ(4,2,"id_scanning.driver_license_not_allowed")," "))}function y(s,m){1&s&&(a.TgZ(0,"div",6),a._UZ(1,"img",7),a.TgZ(2,"h1",8),a._uU(3),a.ALo(4,"transloco"),a.qZA()()),2&s&&(a.xp6(1),a.Q6J("src","https://cdn.verifik.co/assets/biometric-services/Passport.svg",a.LSH),a.xp6(2),a.hij(" ",a.lcZ(4,2,"id_scanning.passport_not_allowed")," "))}function h(s,m){1&s&&(a.TgZ(0,"div",6),a._UZ(1,"img",7),a.TgZ(2,"h1",8),a._uU(3),a.ALo(4,"transloco"),a.qZA()()),2&s&&(a.xp6(1),a.Q6J("src","https://cdn.verifik.co/assets/biometric-services/governmentID.svg",a.LSH),a.xp6(2),a.hij(" ",a.lcZ(4,2,"id_scanning.government_id_not_allowed")," "))}function v(s,m){1&s&&(a.TgZ(0,"div",6),a._UZ(1,"img",9),a.TgZ(2,"h1",8),a._uU(3),a.ALo(4,"transloco"),a.qZA()()),2&s&&(a.xp6(1),a.Q6J("src","https://cdn.verifik.co/demo/redstop.svg",a.LSH),a.xp6(2),a.hij(" ",a.lcZ(4,2,"id_scanning.face_not_found")," "))}function e(s,m){if(1&s&&(a.TgZ(0,"div",6),a._UZ(1,"img",7),a.TgZ(2,"h1",8),a._uU(3),a.ALo(4,"transloco"),a.qZA()()),2&s){const E=a.oxw();a.xp6(1),a.Q6J("src",E.attemptsLimit-E.attempts>0?"https://cdn.verifik.co/demo/failedtodetectdocument@3x.png":"https://cdn.verifik.co/demo/redstop.svg",a.LSH),a.xp6(2),a.hij(" ",a.lcZ(4,2,E.attemptsLimit-E.attempts>0?"id_scanning.document_not_detected":"id_scanning.failed_to_detect_limit")," ")}}function u(s,m){if(1&s&&(a.TgZ(0,"p",8),a._uU(1),a.ALo(2,"transloco"),a.qZA()),2&s){const E=a.oxw();a.xp6(1),a.AsE("",a.lcZ(2,2,"id_scanning.remaining_attempts")," ",E.attemptsLimit-E.attempts,"")}}let t=(()=>{class s{ngOnInit(){console.log({errorContent:this.errorContent,attempts:this.attempts})}tryAgain(E){this.dialogRef&&this.dialogRef.close({addAttempt:1}),this.callback&&this.callback({addAttempt:1})}restartDemo(){this.dialogRef&&this.dialogRef.close({addAttempt:1}),this.callback&&this.callback({addAttempt:1})}static#t=this.\u0275fac=function(I){return new(I||s)};static#e=this.\u0275cmp=a.Xpm({type:s,selectors:[["kyc-document-errors-display"]],inputs:{errorContent:"errorContent",attempts:"attempts",attemptsLimit:"attemptsLimit",dialogRef:"dialogRef",callback:"callback"},standalone:!0,features:[a.jDz],decls:12,vars:10,consts:[["fxLayout","column","fxLayoutAlign","center center",1,"id-scanning-error-div"],["fxLayout","column","fxLayoutAlign","center center",3,"ngSwitch"],["fxLayout","column","fxLayoutAlign","center center",4,"ngSwitchCase"],["fxLayout","column","fxLayoutAlign","center center",4,"ngSwitchDefault"],["class","mt-4",4,"ngIf"],["mat-raised-button","","color","primary",1,"mt-4","z-index-2","id-scanning-try-again-button",3,"click"],["fxLayout","column","fxLayoutAlign","center center"],["alt","",1,"id-scanning-failed-document-img",3,"src"],[1,"mt-4"],["alt","",1,"face_not_found",3,"src"]],template:function(I,b){1&I&&(a.TgZ(0,"div",0)(1,"div",1),a.YNc(2,S,5,4,"div",2),a.YNc(3,w,5,4,"div",2),a.YNc(4,y,5,4,"div",2),a.YNc(5,h,5,4,"div",2),a.YNc(6,v,5,4,"div",2),a.YNc(7,e,5,4,"div",3),a.qZA(),a.YNc(8,u,3,4,"p",4),a.TgZ(9,"button",5),a.NdJ("click",function(){return b.attemptsLimit-b.attempts>0?b.tryAgain(!0):b.restartDemo()}),a._uU(10),a.ALo(11,"transloco"),a.qZA()()),2&I&&(a.xp6(1),a.Q6J("ngSwitch",b.errorContent.message),a.xp6(1),a.Q6J("ngSwitchCase","country_not_allowed"),a.xp6(1),a.Q6J("ngSwitchCase","driver_license_not_allowed"),a.xp6(1),a.Q6J("ngSwitchCase","passport_not_allowed"),a.xp6(1),a.Q6J("ngSwitchCase","government_id_not_allowed"),a.xp6(1),a.Q6J("ngSwitchCase","face_not_found"),a.xp6(2),a.Q6J("ngIf",b.attemptsLimit-b.attempts>0),a.xp6(2),a.hij(" ",a.lcZ(11,8,b.attemptsLimit-b.attempts>0?"id_scanning.retry":"restart")," "))},dependencies:[d.ez,d.O5,d.RF,d.n9,d.ED,C.o9,D.xw,D.Wh,P.y4,P.Ot,x.Ps,T.ot,T.lW],styles:[".id-scanning-error-div[_ngcontent-%COMP%]{width:auto;background:white;height:600px;padding:16px}.id-scanning-error-div[_ngcontent-%COMP%]   .id-scanning-failed-document-img[_ngcontent-%COMP%]{width:45%}.id-scanning-error-div[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{color:#0036e7;font-size:24px;font-weight:800;text-align:center}.id-scanning-error-div[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#01236da6;font-size:16px;font-weight:300;text-align:center}"]})}return s})()},2982:(F,A,r)=>{r.d(A,{Tm:()=>y,i3:()=>S});var d=r(5879),C=r(6814);const T=["video"],x=["canvas"];function P(e,u){if(1&e){const t=d.EpF();d.TgZ(0,"div",6),d.NdJ("click",function(){d.CHM(t);const m=d.oxw();return d.KtG(m.rotateVideoInput(!0))}),d.qZA()}}class a{constructor(u,t,s){this._mimeType=null,this._imageAsBase64=null,this._imageAsDataUrl=null,this._imageData=null,this._mimeType=t,this._imageAsDataUrl=u,this._imageData=s}static getDataFromDataUrl(u,t){return u.replace(`data:${t};base64,`,"")}get imageAsBase64(){return this._imageAsBase64?this._imageAsBase64:this._imageAsBase64=a.getDataFromDataUrl(this._imageAsDataUrl,this._mimeType)}get imageAsDataUrl(){return this._imageAsDataUrl}get imageData(){return this._imageData}}class D{static getAvailableVideoInputs(){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?new Promise((u,t)=>{navigator.mediaDevices.enumerateDevices().then(s=>{u(s.filter(m=>"videoinput"===m.kind))}).catch(s=>{t(s.message||s)})}):Promise.reject("enumerateDevices() not supported.")}}let S=(()=>{class e{constructor(){this.width=640,this.height=480,this.videoOptions=e.DEFAULT_VIDEO_OPTIONS,this.allowCameraSwitch=!0,this.captureImageData=!1,this.imageType=e.DEFAULT_IMAGE_TYPE,this.imageQuality=e.DEFAULT_IMAGE_QUALITY,this.imageCapture=new d.vpe,this.initError=new d.vpe,this.imageClick=new d.vpe,this.cameraSwitched=new d.vpe,this.availableVideoInputs=[],this.videoInitialized=!1,this.activeVideoInputIndex=-1,this.mediaStream=null,this.activeVideoSettings=null}set trigger(t){this.triggerSubscription&&this.triggerSubscription.unsubscribe(),this.triggerSubscription=t.subscribe(()=>{this.takeSnapshot()})}set switchCamera(t){this.switchCameraSubscription&&this.switchCameraSubscription.unsubscribe(),this.switchCameraSubscription=t.subscribe(s=>{"string"==typeof s?this.switchToVideoInput(s):this.rotateVideoInput(!1!==s)})}static getMediaConstraintsForDevice(t,s){const m=s||this.DEFAULT_VIDEO_OPTIONS;return t&&(m.deviceId={exact:t}),m}static getDeviceIdFromMediaStreamTrack(t){if(t.getSettings&&t.getSettings()&&t.getSettings().deviceId)return t.getSettings().deviceId;if(t.getConstraints&&t.getConstraints()&&t.getConstraints().deviceId){const s=t.getConstraints().deviceId;return e.getValueFromConstrainDOMString(s)}}static getFacingModeFromMediaStreamTrack(t){if(t){if(t.getSettings&&t.getSettings()&&t.getSettings().facingMode)return t.getSettings().facingMode;if(t.getConstraints&&t.getConstraints()&&t.getConstraints().facingMode){const s=t.getConstraints().facingMode;return e.getValueFromConstrainDOMString(s)}}}static isUserFacing(t){const s=e.getFacingModeFromMediaStreamTrack(t);return!!s&&"user"===s.toLowerCase()}static getValueFromConstrainDOMString(t){if(t){if(t instanceof String)return String(t);if(Array.isArray(t)&&Array(t).length>0)return String(t[0]);if("object"==typeof t){if(t.exact)return String(t.exact);if(t.ideal)return String(t.ideal)}}return null}ngAfterViewInit(){this.detectAvailableDevices().then(()=>{this.switchToVideoInput(null)}).catch(t=>{this.initError.next({message:t}),this.switchToVideoInput(null)})}ngOnDestroy(){this.stopMediaTracks(),this.unsubscribeFromSubscriptions()}takeSnapshot(){const t=this.nativeVideoElement,s={width:this.width,height:this.height};t.videoWidth&&(s.width=t.videoWidth,s.height=t.videoHeight);const m=this.canvas.nativeElement;m.width=s.width,m.height=s.height;const E=m.getContext("2d");E.drawImage(t,0,0);const I=this.imageType?this.imageType:e.DEFAULT_IMAGE_TYPE,U=m.toDataURL(I,this.imageQuality?this.imageQuality:e.DEFAULT_IMAGE_QUALITY);let j=null;this.captureImageData&&(j=E.getImageData(0,0,m.width,m.height)),this.imageCapture.next(new a(U,I,j))}rotateVideoInput(t){this.availableVideoInputs&&this.availableVideoInputs.length>1&&this.switchToVideoInput(this.availableVideoInputs[(this.activeVideoInputIndex+(t?1:this.availableVideoInputs.length-1))%this.availableVideoInputs.length].deviceId)}switchToVideoInput(t){this.videoInitialized=!1,this.stopMediaTracks(),this.initWebcam(t,this.videoOptions)}videoResize(){}get videoWidth(){const t=this.getVideoAspectRatio();return Math.min(this.width,this.height*t)}get videoHeight(){const t=this.getVideoAspectRatio();return Math.min(this.height,this.width/t)}get videoStyleClasses(){let t="";return this.isMirrorImage()&&(t+="mirrored "),t.trim()}get nativeVideoElement(){return this.video.nativeElement}getVideoAspectRatio(){const t=this.nativeVideoElement;return t.videoWidth&&t.videoWidth>0&&t.videoHeight&&t.videoHeight>0?t.videoWidth/t.videoHeight:this.width/this.height}initWebcam(t,s){const m=this.nativeVideoElement;if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const E=e.getMediaConstraintsForDevice(t,s);navigator.mediaDevices.getUserMedia({video:E}).then(I=>{this.mediaStream=I,m.srcObject=I,m.play(),this.activeVideoSettings=I.getVideoTracks()[0].getSettings();const b=e.getDeviceIdFromMediaStreamTrack(I.getVideoTracks()[0]);this.cameraSwitched.next(b),this.detectAvailableDevices().then(()=>{this.activeVideoInputIndex=b?this.availableVideoInputs.findIndex(U=>U.deviceId===b):-1,this.videoInitialized=!0}).catch(()=>{this.activeVideoInputIndex=-1,this.videoInitialized=!0})}).catch(I=>{this.initError.next({message:I.message,mediaStreamError:I})})}else this.initError.next({message:"Cannot read UserMedia from MediaDevices."})}getActiveVideoTrack(){return this.mediaStream?this.mediaStream.getVideoTracks()[0]:null}isMirrorImage(){if(!this.getActiveVideoTrack())return!1;{let t="auto";switch(this.mirrorImage&&("string"==typeof this.mirrorImage?t=String(this.mirrorImage).toLowerCase():this.mirrorImage.x&&(t=this.mirrorImage.x.toLowerCase())),t){case"always":return!0;case"never":return!1}}return e.isUserFacing(this.getActiveVideoTrack())}stopMediaTracks(){this.mediaStream&&this.mediaStream.getTracks&&(this.nativeVideoElement.pause(),this.mediaStream.getTracks().forEach(t=>t.stop()))}unsubscribeFromSubscriptions(){this.triggerSubscription&&this.triggerSubscription.unsubscribe(),this.switchCameraSubscription&&this.switchCameraSubscription.unsubscribe()}detectAvailableDevices(){return new Promise((t,s)=>{D.getAvailableVideoInputs().then(m=>{this.availableVideoInputs=m,t(m)}).catch(m=>{this.availableVideoInputs=[],s(m)})})}}return e.DEFAULT_VIDEO_OPTIONS={facingMode:"environment"},e.DEFAULT_IMAGE_TYPE="image/jpeg",e.DEFAULT_IMAGE_QUALITY=.92,e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=d.Xpm({type:e,selectors:[["webcam"]],viewQuery:function(t,s){if(1&t&&(d.Gf(T,7),d.Gf(x,7)),2&t){let m;d.iGM(m=d.CRH())&&(s.video=m.first),d.iGM(m=d.CRH())&&(s.canvas=m.first)}},inputs:{width:"width",height:"height",videoOptions:"videoOptions",allowCameraSwitch:"allowCameraSwitch",mirrorImage:"mirrorImage",captureImageData:"captureImageData",imageType:"imageType",imageQuality:"imageQuality",trigger:"trigger",switchCamera:"switchCamera"},outputs:{imageCapture:"imageCapture",initError:"initError",imageClick:"imageClick",cameraSwitched:"cameraSwitched"},decls:6,vars:7,consts:[[1,"webcam-wrapper",3,"click"],["autoplay","","muted","","playsinline","",3,"width","height","resize"],["video",""],["class","camera-switch",3,"click",4,"ngIf"],[3,"width","height"],["canvas",""],[1,"camera-switch",3,"click"]],template:function(t,s){1&t&&(d.TgZ(0,"div",0),d.NdJ("click",function(){return s.imageClick.next()}),d.TgZ(1,"video",1,2),d.NdJ("resize",function(){return s.videoResize()}),d.qZA(),d.YNc(3,P,1,0,"div",3),d._UZ(4,"canvas",4,5),d.qZA()),2&t&&(d.xp6(1),d.Tol(s.videoStyleClasses),d.Q6J("width",s.videoWidth)("height",s.videoHeight),d.xp6(2),d.Q6J("ngIf",s.allowCameraSwitch&&s.availableVideoInputs.length>1&&s.videoInitialized),d.xp6(1),d.Q6J("width",s.width)("height",s.height))},dependencies:[C.O5],styles:[".webcam-wrapper[_ngcontent-%COMP%]{display:inline-block;position:relative;line-height:0}.webcam-wrapper[_ngcontent-%COMP%]   video.mirrored[_ngcontent-%COMP%]{transform:scaleX(-1)}.webcam-wrapper[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{display:none}.webcam-wrapper[_ngcontent-%COMP%]   .camera-switch[_ngcontent-%COMP%]{background-color:#0000001a;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAE9UlEQVR42u2aT2hdRRTGf+cRQqghSqihdBFDkRISK2KDfzDWxHaRQHEhaINKqa1gKQhd6EZLN+IidCH+Q0oWIkVRC21BQxXRitVaSbKoJSGtYGoK2tQ/tU1jY5v0c5F54Xl7b/KSO/PyEt+3e5f75p7zzZwzZ74zUEIJJfyfYaEGllQGVAGZlENdBy6Z2cSiYFTSKkkfS/pH/nBF0kFJdUW9AiRVASeAukD8DgNrzOySrwEzng18KaDzALXuG8W3AiStAvqBisBRNg40mtlPxbYCOgvgPO4bncWW+JpVeDQXRQhIygDfA00F5r0XuNfMrgclQFI98DDQCNQA5ZFXqoCWBVp8XwHRHeEqcN7loy/NbHBesyqpQ1KfFj/6nC+ZvFaApFrgPaCZpYVvgCfNbDiRAElNwGFg+RIt/X8H2s2s9wYCJDUAR4HqJX7++RN40MwGpgmQVAH0AQ2BPz4AHHPl8nBOAqtyFWQjsA6oL4Ada81sPDv7uwImod8kvSJp9RyS8O2SXnb/DYVd2Y9VSroQ4ANXJO2WVJmixqh0kzMWwL4LkiqRtDnA4D1zmfE8j9g9AezcnAHaPcfXdbfdnPZ2Yps6+DwAvO/Z1naTdApY7Xng48BDZnY1MpMVQBuw3iXc5Tnb0wBwBPjUzP6eoezuArZ6svM0geJLkvZEYnl3nkntoqROSbckSW2Suj3ZOIangc7GPJuUtNGdFIfmMeavktoSSKiW9LMPw30Q8JqkekmjCbOZRhuclLQjgYSNxUBAj6RyZ9ATgUJpUtJTCSR8vpAEXHAyWK5BXYFIGHOlepSAloUk4NEYgyoknQhEwhFJ0e8h6VSaQeerCb5uZgdi9utxYBNwOUD93hIVXswM4INCi6K9wAszFC2DwLOBDjHbYp59karIUnRdzYy/3ClqVklaUhfwTICj7K25OqA7a4wWagVsm4Me/xzwg2cCqqONFzO7DPxSCAJi436GUBgHHguQD2oTlJ55oSzP9ybccsttSJw1szdjFOSnI/8dTCGZHwcORp4Nx7y3B1iZ8/sm4MW8/Euxg5wIsS/HaAp3zeP4/G7obRDXI4jiTIA22H7Xdc7X+S3A5lC7QBQ357aq3VAjCeSkwUfAJrfvz+R8A9ADLAtZB+TinpjC5JMA+//jwPZZnF8G7J+L8z4IWB/zbG+gIujVWfLBW/NStVMmqaG4POJRsIjix7h8IGnLQuoBbQki5sVAJHyYm7YkNaRRtXwQ8G1cHpX0iKRrgUjYno17Sf0LrQhJUkdCeHWkVITGJI0k1QeS3ikGSUzOyJUJJNznYneuOCnpTldcxa2kP3xJYqOeSDjqZG8ShJLnE8TTuMS6Iyu1BW7djZqkfo9N0QOuYJmYQddfB7RG+gLTNzqAY9FrL+5/nwEbvDdJJe3zzOrhNP3AWRqmk55t3ZcBuj3b2gb0Sbrbo/NNzk7fFzu7s/E5EiC+rrmeQU0Kx2skvRFoOx2ZzlmSdgbsw49JetvtBpk8nM64d/cGbNtJ0s7cGyJlwHeEv+t3nqnLSgPAUOSGyG3AHUxdzqoJbEcvcL+ZTeTeEapzJKxgaeOcc/7Mf06D7kFrguS0VDAMtGadv+E47DT9tcChJej8ISfpD+abgTe45uOkFi8mnQ+JBVQ+d4VXuOptjavcyot8pq86mfwk8LWZnaOEEkoooYQSSojDv8AhQNeGfe0jAAAAAElFTkSuQmCC);background-repeat:no-repeat;border-radius:5px;position:absolute;right:13px;top:10px;height:48px;width:48px;background-size:80%;cursor:pointer;background-position:center;transition:background-color .2s ease}.webcam-wrapper[_ngcontent-%COMP%]   .camera-switch[_ngcontent-%COMP%]:hover{background-color:#0000002e}"]}),e})(),y=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.oAB({type:e}),e.\u0275inj=d.cJS({imports:[[C.ez]]}),e})()}}]);